import{_ as W}from"./lodash-CX909HOe.js";import{af as X,ad as Z,ae as ee}from"./index-Bhs01vZM.js";import{_ as I}from"./AppDateTimePicker-CfAoPA-s.js";import{_ as j}from"./AppDrawerHeaderSection-CLKYOWA7.js";import{r as d,o as U,f as M,e as t,b as e,n as r,ag as h,am as ae,af as O,v as E,ak as te,w as B,B as le,at as oe,I as re,c as se,d as ie,z as ne}from"./main-C1cSucNj.js";import{P as q}from"./vue3-perfect-scrollbar.esm-WZLAIUT0.js";import{e as de}from"./es-BUdHr6wu.js";import{V as R}from"./VDivider-BS9Tllbl.js";import{V as N}from"./VCard-DoJ7OvEk.js";import{V as F}from"./VCardText-iOQ31nyo.js";import{V as ue}from"./VForm-Dy7iSAGS.js";import{V as z,a as k}from"./VRow-DdYzItfl.js";import{V as me}from"./VSelect-C8_y3N-_.js";import{V as J}from"./VNavigationDrawer-C9-e5Vs5.js";import{_ as pe}from"./DeleteDialog-Dg_2ddC1.js";import{d as ce}from"./baseDateSelectFormat-BbBo-rzt.js";import{$ as C}from"./api-DGW-Fn2Q.js";import{V as fe}from"./VTextField-BDUmA4Cs.js";import{V as G}from"./VAutocomplete-AOfJDvsu.js";import"./VField-BymScPN-.js";import"./form-BJwA8ai1.js";import"./VInput-wvAgDqIB.js";import"./VSpacer-D5JLVMw2.js";/* empty css              */import"./VAvatar-BpNw3P6_.js";import"./VImg-D1aAeOw8.js";import"./VList-CJtIzW8v.js";import"./ssrBoot-DfsiD9ny.js";import"./dialog-transition-apDHIwZf.js";import"./VMenu-D5ZOve3c.js";import"./VCheckboxBtn-DqgUuTHD.js";import"./VSelectionControl-CM7Gd7lS.js";import"./VChip-Js2ye3Ji.js";import"./DialogCloseBtn-d-aRwzHc.js";import"./VDialog-CiCxrpWH.js";import"./index-D-qiIO6U.js";import"./index-9rIf2CJL.js";/* empty css                   */import"./VCounter-tCKPKrdk.js";import"./filter-DDqFtplM.js";const ve={__name:"AddNewHolidayDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},users:{type:Array,default:()=>[]}},emits:["update:isDrawerOpen","holidayData"],setup(g,{emit:y}){const w=g,p=y,u=d(""),i=d(null);d(new Date().getFullYear());const m=d(!1),f=d(),V=()=>p("update:isDrawerOpen",!1),b=()=>{f.value.validate().then(({valid:s})=>{s&&(p("holidayData",{usuario_id:i.value,fechas:u.value}),p("update:isDrawerOpen",!1),te(()=>{f.value.reset(),f.value.resetValidation(),u.value=""}))})},v=s=>{p("update:isDrawerOpen",s)};return(s,l)=>{const n=j,x=I;return U(),M(J,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":w.isDrawerOpen,"onUpdate:modelValue":v},{default:t(()=>[e(n,{title:"Agregar vacaciones",onCancel:V}),e(R),e(r(q),{options:{wheelPropagation:!1}},{default:t(()=>[e(N,{flat:""},{default:t(()=>[e(F,null,{default:t(()=>[e(ue,{ref_key:"refForm",ref:f,modelValue:r(m),"onUpdate:modelValue":l[2]||(l[2]=_=>h(m)?m.value=_:null),onSubmit:ae(b,["prevent"])},{default:t(()=>[e(z,null,{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[e(me,{modelValue:r(i),"onUpdate:modelValue":l[0]||(l[0]=_=>h(i)?i.value=_:null),label:"Usuario",placeholder:"Selecciona un usuario",items:g.users,"item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(x,{modelValue:r(u),"onUpdate:modelValue":l[1]||(l[1]=_=>h(u)?u.value=_:null),label:"Fecha",placeholder:"Selecciona una o mas fechas",config:{mode:"multiple",dateFormat:"Y-m-d",altFormat:"d-m-Y",altInput:!0,locale:r(de.Spanish)}},null,8,["modelValue","config"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(O,{type:"submit",class:"me-4"},{default:t(()=>l[3]||(l[3]=[E(" Aceptar ")])),_:1}),e(O,{type:"reset",variant:"outlined",color:"error",onClick:V},{default:t(()=>l[4]||(l[4]=[E(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},_e={__name:"EditHolidayDrawer",props:{isEditDrawerOpen:{type:Boolean,required:!0},holiday:{type:Object,default:()=>{}}},emits:["update:isEditDrawerOpen","holidayData"],setup(g,{emit:y}){const w=g,p=y,u=d(!1),i=d({id:null,fecha:null,nombre:null}),m=()=>p("update:isEditDrawerOpen",!1),f=l=>p("update:isEditDrawerOpen",l),V=()=>u.value=!0,b=async()=>{try{const l=await C(`/delete-vacaciones/${i.value.id}`,{method:"GET"});s()}catch{}},v=async()=>{try{const l=await C("/editar-vacaciones",{method:"POST",body:i.value});s()}catch{}},s=()=>{p("holidayData"),u.value=!1,i.value={id:null,fecha:null,nombre:null}};return B(()=>w.holiday,l=>{l.id&&(i.value=l)}),(l,n)=>{const x=j,_=I,T=pe;return U(),M(J,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":w.isEditDrawerOpen,"onUpdate:modelValue":f},{default:t(()=>[e(x,{title:"Editar fecha",onCancel:m}),e(R),e(r(q),{options:{wheelPropagation:!1}},{default:t(()=>[e(N,{flat:""},{default:t(()=>[e(F,null,{default:t(()=>[e(z,null,{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[e(fe,{modelValue:r(i).nombre,"onUpdate:modelValue":n[0]||(n[0]=D=>r(i).nombre=D),disabled:"",label:"Nombre",placeholder:"nombre"},null,8,["modelValue"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(_,{modelValue:r(i).fecha,"onUpdate:modelValue":n[1]||(n[1]=D=>r(i).fecha=D),label:"Fecha",placeholder:"Selecciona una fecha",config:r(ce)},null,8,["modelValue","config"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(O,{onClick:v,class:"me-4"},{default:t(()=>n[3]||(n[3]=[E(" Guardar ")])),_:1}),e(O,{onClick:V,class:"me-4"},{default:t(()=>n[4]||(n[4]=[E(" Eliminar ")])),_:1}),e(O,{type:"reset",variant:"outlined",color:"error",onClick:m},{default:t(()=>n[5]||(n[5]=[E(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{isDialogVisible:r(u),"onUpdate:isDialogVisible":n[2]||(n[2]=D=>h(u)?u.value=D:null),id:g.holiday.id,onSubmit:b},null,8,["isDialogVisible","id"])]),_:1})]),_:1},8,["model-value"])}}},ye={class:"app-user-search-filter d-flex align-center"},sa={__name:"index",async setup(g){let y,w;const p=d(),u=d({}),i=d(!1),m=d(null),f=d([]),V=le("userData"),b=d({id:null,fecha:null,nombre:null}),v=d(!1),s=d({usuario_id:null,selected_date:null,id_empresa:null});m.value=V.value.id_role==2?V.value.id_empresa:null;const l=d(null),n=async(a,o,c,$)=>{var P;try{const S=await C(`/get-all-vacaciones?month=${a}&year=${o}&usuario_id=${c}&id_empresa=${$}`,{method:"GET"});((P=l.value)==null?void 0:P.getEvents()).forEach(A=>{var Y;((Y=l.value)==null?void 0:Y.getEventById(A.id)).remove()}),u.value=W.countBy(S,"date"),S.forEach(A=>{var H;return(H=l.value)==null?void 0:H.addEvent(A)})}catch(S){console.error(S)}},x=async a=>{const o=a.fechas.split(",");await C("/save-vacaciones",{method:"POST",body:{vacaciones:o,id_usuario:a.usuario_id}}),Q()},_=([y,w]=oe(()=>C("/empresas-all",{method:"GET"})),y=await y,w(),y),T=async a=>{try{const o=await C(`/get-usuarios-empleados-all/${a}`,{method:"POST"});o.unshift({id:null,name:"Todos"}),f.value=o}catch{}},D=()=>{v.value=!1;let a=s.value.selected_date.getMonth()+1,o=s.value.selected_date.getFullYear();n(a,o,s.value.usuario_id)},K=d({plugins:[Z,ee],initialView:"dayGridMonth",datesSet:a=>{s.value.selected_date=new Date((a.start.getTime()+a.end.getTime())/2)},locale:"es",firstDay:1,events:[],eventClassNames({event:a}){return u.value[a.startStr]&&u.value[a.startStr]>=2?"bg-light-red pointer":"bg-light-green pointer"},eventClick:function(a){b.value={id:a.event.id,fecha:a.event.startStr,nombre:a.event.title},v.value=!0}}),L=()=>i.value=!0;re(()=>{l.value=p.value.getApi()});const Q=()=>{let a=s.value.selected_date.getMonth()+1,o=s.value.selected_date.getFullYear();n(a,o,null)};return B(m,async(a,o)=>{s.value.usuario_id=null,s.value.id_empresa=a,T(a)},{immediate:!0}),B(s,async(a,o)=>{let c=a.selected_date.getMonth()+1,$=a.selected_date.getFullYear();n(c,$,a.usuario_id,a.id_empresa)},{deep:!0}),(a,o)=>(U(),se("section",null,[e(N,{title:"Filtros",class:"mb-6"},{default:t(()=>[e(F,{class:"d-flex flex-wrap gap-4"},{default:t(()=>[ie("div",ye,[r(V).id_role==1?(U(),M(G,{key:0,style:{width:"200px"},modelValue:r(m),"onUpdate:modelValue":o[0]||(o[0]=c=>h(m)?m.value=c:null),density:"compact",class:"me-2",label:"Empresas",placeholder:"Empresa",items:r(_),"item-value":"id","item-title":"nombre"},null,8,["modelValue","items"])):ne("",!0),e(G,{style:{width:"200px"},modelValue:r(s).usuario_id,"onUpdate:modelValue":o[1]||(o[1]=c=>r(s).usuario_id=c),density:"compact",class:"me-2",label:"Usuarios",placeholder:"Usuario",items:r(f),"item-value":"id","item-title":"name"},null,8,["modelValue","items"]),e(O,{onClick:L},{default:t(()=>o[4]||(o[4]=[E("Agregar vacaciones ")])),_:1})])]),_:1}),e(F,{class:"pa-4"},{default:t(()=>[e(r(X),{ref_key:"refCalendar",ref:p,options:r(K)},null,8,["options"])]),_:1})]),_:1}),e(ve,{isDrawerOpen:r(i),"onUpdate:isDrawerOpen":o[2]||(o[2]=c=>h(i)?i.value=c:null),users:r(f),onHolidayData:x},null,8,["isDrawerOpen","users"]),e(_e,{isEditDrawerOpen:r(v),"onUpdate:isEditDrawerOpen":o[3]||(o[3]=c=>h(v)?v.value=c:null),holiday:r(b),onHolidayData:D},null,8,["isEditDrawerOpen","holiday"])]))}};export{sa as default};
