import{p as K}from"./paginationMeta-BbY5dJ0C.js";import{aT as F,r as m,w as A,o as I,f as L,e as i,b as l,n as e,ag as w,am as W,af as O,v as x,ak as X,I as Y,c as Z,aM as ee,d as S,x as q,a0 as N,a as le}from"./main-BwDGDDDW.js";import{r as h,e as ae}from"./validators-CrSGMxiT.js";import{_ as oe}from"./AppDateTimePicker-BgncYox4.js";import{_ as te}from"./AppDrawerHeaderSection-Dm2jDqJm.js";import{P as ie}from"./vue3-perfect-scrollbar.esm-BA1GFVP8.js";import{a as E}from"./api-CjWrXaZL.js";import{V as j}from"./VDivider-PVfbuN4-.js";import{V as z}from"./VCard-Cpw0jw9u.js";import{V as J}from"./VCardText-BKkdmkn-.js";import{V as re}from"./VForm-DbaU_ACV.js";import{V as se,a as p}from"./VRow-DJH2tZVu.js";import{V as D}from"./VTextField-DqZOZREA.js";import{V as M}from"./VTextarea-Ugpn_Hk5.js";import{V as ne}from"./VNavigationDrawer-DiCpI_FT.js";import{_ as de}from"./ConfirmDialog-BcB1qS-q.js";import{V as ue}from"./VDataTableServer-BLeqennM.js";import{V as me}from"./VSelect-Cdsnm3mB.js";import"./helpers-DK5QwNv0.js";import"./VField-5sqsN37e.js";import"./form-BEvPHhJ7.js";import"./VInput-CVFVwJKu.js";import"./VSpacer-xWNtBUsj.js";/* empty css              */import"./VAvatar-DYn3is-W.js";import"./VImg-BYy41-F9.js";import"./index-D8byVCHt.js";import"./index-9rIf2CJL.js";/* empty css                   */import"./VCounter-IA5S7b1U.js";import"./ssrBoot-B7QpyNAy.js";import"./VDialog-5yhkawgU.js";import"./dialog-transition-GiYjLY5n.js";import"./VDataTable-B4BcEe_U.js";import"./VPagination-DIhj3juL.js";import"./VCheckboxBtn-CuvLREeJ.js";import"./VSelectionControl-D0_t5DTC.js";import"./VTable-CK8MMDdB.js";import"./filter-B9tzeaPh.js";import"./VList-CLtMWoGj.js";import"./VMenu-BWP2lKbi.js";import"./VChip-CXCzEWTC.js";const pe={__name:"AddNewClientDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},item:{type:Object,default:()=>null}},emits:["update:isDrawerOpen","refresh"],setup($,{emit:C}){const v=$,U=F(),c=C,u=m({}),a=m({id:null,dni:"",nombre:"",apellidos:"",email:"",fecha_nacimiento:"",telefono:"",profesion:"",observaciones:"",ciudad:"",pais:"",direccion:""}),k=m(!1),b=m(),P=()=>{u.value={},c("update:isDrawerOpen",!1)},T=async()=>{try{u.value={};const t=await E("/saveusuario",{method:"POST",body:a.value});U.success(t.message),c("refresh",t),c("update:isDrawerOpen",!1)}catch(t){U.error(t.response._data.message),t.status==422&&(u.value=t.response._data.errors)}},_=async()=>{var f;const{valid:t,errors:o}=await((f=b.value)==null?void 0:f.validate());t&&await T()},g=()=>{X(()=>{var t,o;(t=b.value)==null||t.reset(),(o=b.value)==null||o.resetValidation()}),a.value={id:null,dni:"",nombre:"",apellidos:"",email:"",fecha_nacimiento:"",telefono:"",profesion:"",observaciones:"",ciudad:"",pais:"",direccion:""}};A(()=>{v.item!=null?a.value=JSON.parse(JSON.stringify(v.item)):g()});const V=t=>{c("update:isDrawerOpen",t)};return(t,o)=>{const f=te,B=oe;return I(),L(ne,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":V},{default:i(()=>[l(f,{title:v.item!=null?"Editar cliente":"Agregar cliente",onCancel:P},null,8,["title"]),l(j),l(e(ie),{options:{wheelPropagation:!1}},{default:i(()=>[l(z,{flat:""},{default:i(()=>[l(J,null,{default:i(()=>[l(re,{ref_key:"refForm",ref:b,modelValue:e(k),"onUpdate:modelValue":o[10]||(o[10]=s=>w(k)?k.value=s:null),onSubmit:W(_,["prevent"])},{default:i(()=>[l(se,null,{default:i(()=>[l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).nombre,"onUpdate:modelValue":o[0]||(o[0]=s=>e(a).nombre=s),rules:["requiredValidator"in t?t.requiredValidator:e(h)],label:"Nombre",placeholder:"John"},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e(a).apellidos=s),rules:["requiredValidator"in t?t.requiredValidator:e(h)],label:"Apellidos",placeholder:"Doe"},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).dni,"onUpdate:modelValue":o[2]||(o[2]=s=>e(a).dni=s),rules:["requiredValidator"in t?t.requiredValidator:e(h)],label:"DNI",placeholder:"12345678B"},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).telefono,"onUpdate:modelValue":o[3]||(o[3]=s=>e(a).telefono=s),rules:["requiredValidator"in t?t.requiredValidator:e(h)],label:"Teléfono",placeholder:"123456789"},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).email,"onUpdate:modelValue":o[4]||(o[4]=s=>e(a).email=s),rules:["requiredValidator"in t?t.requiredValidator:e(h),"emailValidator"in t?t.emailValidator:e(ae)],label:"Email",placeholder:"johndoe@email.com","error-messages":e(u).email?e(u).email[0]:""},null,8,["modelValue","rules","error-messages"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(B,{modelValue:e(a).fecha_nacimiento,"onUpdate:modelValue":o[5]||(o[5]=s=>e(a).fecha_nacimiento=s),label:"Fecha de nacimiento",placeholder:"Selecciona una fecha"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).ciudad,"onUpdate:modelValue":o[6]||(o[6]=s=>e(a).ciudad=s),label:"Ciudad",placeholder:"Almoradí"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(D,{modelValue:e(a).pais,"onUpdate:modelValue":o[7]||(o[7]=s=>e(a).pais=s),label:"País",placeholder:"España"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(M,{modelValue:e(a).direccion,"onUpdate:modelValue":o[8]||(o[8]=s=>e(a).direccion=s),label:"Dirección",placeholder:"Incluye calle, código postal, referencias, etc."},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(M,{modelValue:e(a).observaciones,"onUpdate:modelValue":o[9]||(o[9]=s=>e(a).observaciones=s),label:"Observaciones",placeholder:"Escribe notas relevantes del cliente"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(O,{type:"submit",class:"me-4"},{default:i(()=>o[11]||(o[11]=[x(" Aceptar ")])),_:1}),l(O,{type:"reset",variant:"outlined",color:"error",onClick:P},{default:i(()=>o[12]||(o[12]=[x(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ce={class:"app-user-search-filter d-flex align-center"},fe={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},Ve={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},ve={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},be={class:"d-flex gap-x-2 align-center me-2"},rl={__name:"index",setup($){F();const C=m(!1),v=m("success"),U=m(""),c=m(""),u=m(10),a=m(1),k=m(),b=m(),P=n=>{var r,y;a.value=n.page,k.value=(r=n.sortBy[0])==null?void 0:r.key,b.value=(y=n.sortBy[0])==null?void 0:y.order},T=[{title:"Nombre",key:"nombre"},{title:"Apellidos",key:"apellidos"},{title:"DNI",key:"dni"},{title:"Email",key:"email"},{title:"Teléfono",key:"telefono"},{title:"Acciones",key:"actions",sortable:!1}],_={1:"administrador",2:"usuario",3:"turno"},g=m(!1),V=m(null),t=m([]),o=m(0),f=m(!1),B=async()=>{try{const n=await E("/getusuarios",{method:"GET",params:{search:c.value,itemsPerPage:u.value,page:a.value,sortBy:k.value,orderBy:b.value}});t.value=n.data,o.value=n.total}catch(n){console.error(n)}},s=async()=>{try{const n=await E(`/deleteusuario/${V.value.id}`,{method:"GET"});f.value=!1;let r=t.value.findIndex(y=>y.id==V.value.id);r>-1&&t.value.splice(r,1),v.value="success",U.value=n.message,C.value=!0}catch(n){v.value="error",U.value=n.response._data.message,C.value=!0}},R=()=>{g.value=!0,V.value=null},G=n=>{g.value=!0,V.value=n},Q=n=>{V.value=n,f.value=!0};return Y(B),A([u,k,b,a,c],()=>{B()}),A(g,async n=>{n||(V.value={})}),(n,r)=>{const y=le("IconBtn");return I(),Z("section",null,[l(z,{title:"Filtros",class:"mb-6"},{default:i(()=>[l(J,{class:"d-flex flex-wrap gap-4"},{default:i(()=>[S("div",ce,[l(D,{modelValue:e(c),"onUpdate:modelValue":r[0]||(r[0]=d=>w(c)?c.value=d:null),placeholder:"Buscar",density:"compact",class:"me-4"},null,8,["modelValue"]),l(O,{onClick:R},{default:i(()=>r[9]||(r[9]=[x(" Agregar nuevo cliente ")])),_:1})])]),_:1}),l(ue,{"items-per-page":e(u),"onUpdate:itemsPerPage":r[4]||(r[4]=d=>w(u)?u.value=d:null),page:e(a),"onUpdate:page":r[5]||(r[5]=d=>w(a)?a.value=d:null),items:e(t),"item-value":"id","items-length":e(o),headers:T,class:"text-no-wrap rounded-0","onUpdate:options":P},{"item.role":i(({item:d})=>[x(q(_[d.role]),1)]),"item.actions":i(({item:d})=>[l(y,{size:"small",onClick:H=>Q(d)},{default:i(()=>[l(N,{icon:"ri-delete-bin-7-line"})]),_:2},1032,["onClick"]),l(y,{size:"small",onClick:H=>G(d)},{default:i(()=>[l(N,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["onClick"]),l(y,{size:"small",to:{name:"apps-clients-view-id",params:{id:d.id}}},{default:i(()=>[l(N,{icon:"ri-eye-line",title:"Detalles"})]),_:2},1032,["to"])]),bottom:i(()=>[l(j),S("div",fe,[S("div",Ve,[r[10]||(r[10]=x(" Filas por página: ")),l(me,{modelValue:e(u),"onUpdate:modelValue":r[1]||(r[1]=d=>w(u)?u.value=d:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),S("p",ve,q(("paginationMeta"in n?n.paginationMeta:e(K))({page:e(a),itemsPerPage:e(u)},e(o))),1),S("div",be,[l(O,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:e(a)<=1,onClick:r[2]||(r[2]=d=>e(a)<=1?a.value=1:a.value--)},null,8,["disabled"]),l(O,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:e(a)>=Math.ceil(e(o)/e(u)),onClick:r[3]||(r[3]=d=>e(a)>=Math.ceil(e(o)/e(u))?a.value=Math.ceil(e(o)/e(u)):a.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),l(pe,{isDrawerOpen:e(g),"onUpdate:isDrawerOpen":r[6]||(r[6]=d=>w(g)?g.value=d:null),item:e(V),onRefresh:B},null,8,["isDrawerOpen","item"]),l(de,{isDialogVisible:e(f),"onUpdate:isDialogVisible":r[7]||(r[7]=d=>w(f)?f.value=d:null),confirmationQuestion:"¿Está seguro que desea eliminar el cliente seleccionado?",note:"Se eliminaran todas las citas asociadas",onConfirm:s},null,8,["isDialogVisible"]),l(ee,{location:"top end",modelValue:e(C),"onUpdate:modelValue":r[8]||(r[8]=d=>w(C)?C.value=d:null),color:e(v)},{default:i(()=>[x(q(e(U)),1)]),_:1},8,["modelValue","color"])])}}};export{rl as default};
