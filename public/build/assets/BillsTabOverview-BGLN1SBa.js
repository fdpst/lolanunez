import{_ as K}from"./UserUpgradePlanDialog-C4_ykn8R.js";import{_ as Q}from"./UserInfoEditDialog-Boc_b8PV.js";import{_ as W}from"./AppDateTimePicker-CfAoPA-s.js";import{r as v,I as L,w as b,o as C,f as S,e as o,L as X,d as u,n as i,ag as N,y as Y,aN as Z,c as ee,b as a,F as te,a as ae,af as A,v as F,a0 as O,x as B}from"./main-C1cSucNj.js";import{a as T}from"./api-DGW-Fn2Q.js";import{I as le}from"./VImg-D1aAeOw8.js";import{V as oe}from"./VAutocomplete-AOfJDvsu.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as g,V as z}from"./VRow-DdYzItfl.js";import{V as E}from"./VCard-DoJ7OvEk.js";import{V as I}from"./VCardText-iOQ31nyo.js";import{V as R}from"./VDivider-BS9Tllbl.js";import{V as se}from"./VTextarea-AN9uyN0u.js";import{V as j}from"./VTextField-BDUmA4Cs.js";import"./useApi-DTDttPdq.js";import{V as ne}from"./VSelect-C8_y3N-_.js";import{V as re}from"./VDataTable-r1BGz7ia.js";import{V as ue}from"./VAvatar-BpNw3P6_.js";const de={__name:"ClienteSelect",props:{modelValue:{},extra:{},label:{},"item-text":{},hint:{},"persistent-hint":{},"return-object":{},classe:{}},emits:["update:modelValue"],setup(w,{emit:h}){const d=w,y=h,V=v(d.modelValue),c=v(null),n=v(1),t=v([]),s=async()=>{try{n.value=1;const r=await T("/getusuarios?itemsPerPage=15&page=1");t.value=r.data,d.extra&&t.value.push(d.extra)}catch(r){console.error("Error loading clients:",r)}},D=Z(async r=>{if(c.value!==r){if(r!=null)try{n.value=1;const m=await T(`/getusuarios?itemsPerPage=15&page=1&busqueda=${r}`);t.value=m.data}catch(m){console.error("Error searching clients:",m)}c.value=r}},500),x=async(r,m,p)=>{if(p){n.value+=1;const k=await T(`/getusuarios?itemsPerPage=15&page=${n.value}`);t.value=[...t.value,...k.data]}};return L(async()=>{d.value!=null&&(V.value=d.value),await s()}),b(()=>d.modelValue,r=>{r!==V.value&&(V.value=r)}),b(()=>V.value,r=>{y("update:modelValue",r)}),(r,m)=>(C(),S(oe,{"onUpdate:searchInput":i(D),modelValue:i(V),"onUpdate:modelValue":m[0]||(m[0]=p=>N(V)?V.value=p:null),items:i(t),"item-title":"full_name","item-value":"id",label:d.label,hint:d.hint,"persistent-hint":d.persistentHint,"return-object":d.returnObject,class:Y(d.classe)},{"append-item":o(()=>[X(u("div",null,null,512),[[le,x]])]),_:1},8,["onUpdate:searchInput","modelValue","items","label","hint","persistent-hint","return-object","class"]))}},ce={__name:"BillsBioPanel",props:{data:{type:Object,default:()=>null}},emits:["changeData"],setup(w,{emit:h}){const d=w,y=h,V=v(!1),c=v(!1);v([]),v([]);const n=v({id_cliente:null,fecha:new Date(Date.now()-new Date().getTimezoneOffset()*6e4).toISOString().substr(0,10),comentario:"",cuenta:null,incluir_iva:!0,descuento:0});return L(()=>{}),b(n.value,t=>{y("changeData",t)}),b(()=>{d.data!=null&&(n.value=d.data)}),(t,s)=>{const D=de,x=W,r=Q,m=K;return C(),ee(te,null,[a(z,null,{default:o(()=>[a(g,{cols:"12"},{default:o(()=>[a(E,null,{default:o(()=>[a(I,null,{default:o(()=>[s[6]||(s[6]=u("h5",{class:"text-h5"},"Datos del cliente y fecha",-1)),a(R,{class:"my-4"}),a(D,{label:"Cliente",modelValue:i(n).id_cliente,"onUpdate:modelValue":s[0]||(s[0]=p=>i(n).id_cliente=p),class:"mt-3"},null,8,["modelValue"]),a(x,{label:"Fecha",modelValue:i(n).fecha,"onUpdate:modelValue":s[1]||(s[1]=p=>i(n).fecha=p),class:"mt-3"},null,8,["modelValue"]),a(se,{label:"Descripción-notas",placeholder:"Escribe aquí lo necesario",class:"mt-3",modelValue:i(n).comentario,"onUpdate:modelValue":s[2]||(s[2]=p=>i(n).comentario=p)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12"},{default:o(()=>[a(E,{flat:""},{default:o(()=>[a(I,null,{default:o(()=>[s[7]||(s[7]=u("div",{class:"d-flex align-center"},[u("div",null,[u("h5",{class:"text-h5 text-white mb-4"}," Descuentos y cuentas ")])],-1)),a(j,{label:"Descuento %",modelValue:i(n).descuento,"onUpdate:modelValue":s[3]||(s[3]=p=>i(n).descuento=p)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(r,{isDialogVisible:i(V),"onUpdate:isDialogVisible":s[4]||(s[4]=p=>N(V)?V.value=p:null)},null,8,["isDialogVisible"]),a(m,{isDialogVisible:i(c),"onUpdate:isDialogVisible":s[5]||(s[5]=p=>N(c)?c.value=p:null)},null,8,["isDialogVisible"])],64)}}},Ne=ie(ce,[["__scopeId","data-v-3e7e45ec"]]),me={class:"d-flex gap-4 align-center"},pe={class:"mb-0 text-base"},ve={class:"text-primary font-weight-medium text-lg me-1"},fe={class:"mb-0 text-base"},_e={class:"text-primary font-weight-medium text-lg me-1"},Ve={class:"mb-0 text-base"},xe={class:"text-primary font-weight-medium text-lg me-1"},ge={class:"mb-0 text-base"},be={class:"text-primary font-weight-medium text-lg me-1"},ze={__name:"BillsTabOverview",props:{data:{type:Object,default:()=>{}},items:{type:Array,default:()=>[]}},emits:["changeItems","changeData"],setup(w,{emit:h}){const d=w,y=h,V=[{title:"Descripción",key:"descripcion"},{title:"Cantidad",key:"cantidad"},{title:"Precio",key:"precio"},{title:"Importe",key:"total"},{title:"Acciones",key:"actions",sortable:!1}],c=v([]),n=v(null),t=v({id:"",id_articulo:null,descripcion:"",cantidad:0,precio:parseFloat(0).toFixed(2),total:parseFloat(0).toFixed(2)}),s=v(0),D=v(parseFloat(0).toFixed(2)),x=v(parseFloat(0).toFixed(2)),r=v(!0),m=v([]),p=async()=>{try{const l=await T("/getallservicios",{method:"GET"});m.value=l||[]}catch(l){console.error("Error loading articulos:",l),m.value=[]}},k=()=>{n.value=null,t.value={id:Date.now()+"a",id_articulo:null,descripcion:"",cantidad:0,precio:parseFloat(0).toFixed(2),total:parseFloat(0).toFixed(2)}},U=()=>c.value.reduce((e,_)=>{let $=parseFloat(_.total)/1.21;return e=parseFloat(e)+parseFloat($),e=parseFloat(e).toFixed(2),e},0),H=()=>U()*s.value/100,q=l=>{if(r.value==!0){const _=parseFloat(U()).toFixed(2)*21/100;return D.value=_,_}else return D.value=0,0},P=()=>{let l=U();l=parseFloat(l).toFixed(2);let e=H();e=parseFloat(e).toFixed(2);let _=q();return x.value=l-e+_,y("changeData",x.value),parseFloat(x.value).toFixed(2)},J=()=>{if(t.value.id_articulo!=""&&t.value.cantidad!=""&&t.value.precio!=""&&t.value.total!=""){t.value.id=Date.now()+"a";const l=m.value.find(e=>e.id==t.value.id_articulo).nombre;if(n.value!=null){const e=c.value.find(f=>f==n.value),_=c.value.findIndex(f=>f==n.value);console.log("index",_),console.log("linea",e),console.log("descripcion",l),e.id_articulo=t.value.id_articulo,e.descripcion=l,e.cantidad=t.value.cantidad,e.precio=t.value.precio,e.total=t.value.total,c.value[_]=e}else t.value.descripcion=l,c.value.push(t.value);k(),P(),y("changeItems",{itemsFactura:c.value,total:x.value,descuento:s.value})}},G=l=>{n.value=l;let e=JSON.parse(JSON.stringify(l));t.value.id_articulo=e.id_articulo,t.value.descripcion=m==null?void 0:m.value.find(_=>_.id==e.id_articulo).nombre,t.value.cantidad=e.cantidad,t.value.precio=e.precio,t.value.total=e.total,t.value.id=e.id},M=l=>{const e=c.value.indexOf(l);e>-1&&(c.value.splice(e,1),P())};return b(()=>t.value.cantidad,(l,e)=>{t.value.total=parseFloat(l*t.value.precio).toFixed(2)}),b(()=>t.value.precio,(l,e)=>{t.value.total=parseFloat(t.value.cantidad*l).toFixed(2)}),b(d,l=>{s.value=l.data.descuento,r.value=l.data.incluir_iva,c.value=l.items,P()}),b(()=>d.data.descuento,l=>{s.value=parseFloat(l)||0,P()},{immediate:!0}),L(async()=>{await p()}),(l,e)=>{const _=ae("IconBtn");return C(),S(z,{class:"match-height"},{default:o(()=>[a(g,null,{default:o(()=>[a(E,null,{default:o(()=>[a(I,null,{default:o(()=>e[4]||(e[4]=[u("div",{class:"d-flex align-center justify-sm-space-between justify-start flex-wrap gap-4"},[u("div",{class:"text-h5"},"Datos del servicio a facturar")],-1)])),_:1}),a(I,null,{default:o(()=>[a(z,null,{default:o(()=>[a(g,{cols:"12",md:"6"},{default:o(()=>[a(ne,{label:"Servicio",modelValue:i(t).id_articulo,"onUpdate:modelValue":e[0]||(e[0]=f=>i(t).id_articulo=f),items:i(m),"item-title":"nombre","item-value":"id"},null,8,["modelValue","items"])]),_:1}),a(g,{cols:"12",md:"2"},{default:o(()=>[a(j,{label:"Cantidad",type:"number",modelValue:i(t).cantidad,"onUpdate:modelValue":e[1]||(e[1]=f=>i(t).cantidad=f)},null,8,["modelValue"])]),_:1}),a(g,{cols:"12",md:"2"},{default:o(()=>[a(j,{label:"Precio",type:"number",modelValue:i(t).precio,"onUpdate:modelValue":e[2]||(e[2]=f=>i(t).precio=f)},null,8,["modelValue"])]),_:1}),a(g,{cols:"12",md:"2"},{default:o(()=>[a(j,{label:"Importe",type:"number",modelValue:i(t).total,"onUpdate:modelValue":e[3]||(e[3]=f=>i(t).total=f),readonly:""},null,8,["modelValue"])]),_:1}),a(g,{class:"d-flex gap-4"},{default:o(()=>[i(n)==null?(C(),S(A,{key:0,onClick:J},{default:o(()=>e[5]||(e[5]=[F("Agregar servicio")])),_:1})):(C(),S(A,{key:1,onClick:J},{default:o(()=>e[6]||(e[6]=[F("Actualizar servicio")])),_:1})),a(A,{color:"sevcundary",variant:"outlined",onClick:k},{default:o(()=>e[7]||(e[7]=[F("Limpiar Servicio")])),_:1})]),_:1})]),_:1})]),_:1}),a(re,{headers:V,items:i(c),class:"text-no-wrap rounded-0"},{"item.actions":o(({item:f})=>[a(_,{size:"small",onClick:$=>M(f)},{default:o(()=>[a(O,{icon:"ri-delete-bin-7-line",title:"Eliminar"})]),_:2},1032,["onClick"]),a(_,{size:"small",onClick:$=>G(f)},{default:o(()=>[a(O,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(R)]),_:1},8,["items"])]),_:1})]),_:1}),a(g,{cols:"12"},{default:o(()=>[a(E,null,{default:o(()=>[a(I,{class:"d-flex gap-2 justify-center"},{default:o(()=>[u("div",me,[a(ue,{variant:"tonal",color:"primary",style:{width:"100px",height:"100px"}},{default:o(()=>[a(O,{style:{width:"85px",height:"85px"},icon:"ri-money-euro-circle-line"})]),_:1}),u("div",null,[e[12]||(e[12]=u("h6",{class:"text-lg font-weight-medium"},"Totales",-1)),u("p",pe,[e[8]||(e[8]=F(" Subtotal: ")),u("span",ve,B(parseFloat(U()).toFixed(2))+"€ ",1)]),u("p",fe,[e[9]||(e[9]=F(" Descuento: ")),u("span",_e,B(parseFloat(H()).toFixed(2))+"€ ",1)]),u("p",Ve,[e[10]||(e[10]=F(" Iva: ")),u("span",xe,B(parseFloat(q(!1)).toFixed(2))+"€ ",1)]),u("p",ge,[e[11]||(e[11]=F(" Total: ")),u("span",be,B(parseFloat(i(x)).toFixed(2))+"€ ",1)])])])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ne as B,ze as _};
