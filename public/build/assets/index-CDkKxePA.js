import{$ as E}from"./api-DoG2ksOD.js";import{p as le}from"./paginationMeta-BbY5dJ0C.js";import{r as u,w as $,o as S,f as F,e as i,b as a,n as e,ag as y,am as oe,af as B,v as T,ak as te,B as ie,at as J,a6 as R,I as re,c as se,d as x,z as j,a0 as N,x as ne,a as de}from"./main-XhKa_9tU.js";import{_ as pe}from"./DeleteDialog-BRmGayw-.js";import{r as v}from"./validators-CrSGMxiT.js";import{_ as me}from"./AppDateTimePicker-CGZ5NR7j.js";import{_ as ue}from"./AppDrawerHeaderSection-C-4ZcHAe.js";import{P as ce}from"./vue3-perfect-scrollbar.esm-CvKV9PJx.js";import{d as fe}from"./baseDateSelectFormat-Ct7V_-XQ.js";import{V as H}from"./VDivider-C4lH0ooT.js";import{V as L}from"./VCard-Eaj0dfV-.js";import{V as Q}from"./VCardText-B_O88IhU.js";import{V as Ve}from"./VForm-BH9swDaI.js";import{V as ve,a as V}from"./VRow-CFasNknx.js";import{V as U}from"./VTextField-DG88OKPn.js";import{V as M}from"./VSelect-BBvcpHuX.js";import{V as ge}from"./VTextarea-Cj3nH6DE.js";import{V as ye}from"./VNavigationDrawer-RrJ7CuuC.js";import{V as be}from"./VDataTableServer-dLSgHCq6.js";import"./index-C3NwvUM2.js";import"./index-9rIf2CJL.js";import"./DialogCloseBtn-CNCrzKby.js";import"./VDialog-0i2MyK-R.js";import"./dialog-transition-B2pKVHb-.js";import"./helpers-DK5QwNv0.js";import"./VField-CvyOoNAD.js";import"./form-BsyuclTd.js";import"./VInput-DCf9aRQz.js";import"./VSpacer-BCVgdAwd.js";/* empty css              */import"./VAvatar-BgIHgX1n.js";import"./VImg-BWevH90G.js";import"./es-CnrgMVhh.js";/* empty css                   */import"./VCounter-zOsFyD3o.js";import"./VList-DjfFgeFe.js";import"./ssrBoot-BEJ69UV0.js";import"./VMenu-D_PRx64v.js";import"./VCheckboxBtn-CKjjSpr9.js";import"./VSelectionControl-BXoDVL8N.js";import"./VChip-BBE3Enfq.js";import"./VDataTable-CrfrFXcg.js";import"./VPagination-64W-UBzK.js";import"./VTable-Cb5v_Kut.js";import"./filter-Bi6u83zm.js";const we={__name:"AddNewCompanyDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},provincias:{type:Array,default:()=>[]},company:{type:Object,default:()=>null},tipos:{type:Array,default:null}},emits:["update:isDrawerOpen","companyData"],setup(I,{emit:f}){const c=I,g=f,o=u({id:null,nombre:"",cif:"",ccc:"",localidad:"",codigo_postal:"",provincia_id:null,url_image:"",id_tipo:null,externo:!1,direccion:""}),m=u(!1),d=u(),b=()=>{g("update:isDrawerOpen",!1)},q=()=>{var r;(r=d.value)==null||r.validate().then(({valid:l})=>{l&&(g("companyData",o),g("update:isDrawerOpen",!1),te(()=>{var w,D;(w=d.value)==null||w.reset(),(D=d.value)==null||D.resetValidation()}))})},h=()=>{o.value={id:null,nombre:"",cif:"",ccc:"",localidad:"",codigo_postal:"",provincia_id:null,url_image:"",id_tipo:null,externo:!1,direccion:""}};$(()=>{c.company!=null?o.value=JSON.parse(JSON.stringify(c.company)):h()});const A=r=>{g("update:isDrawerOpen",r)};return(r,l)=>{const w=ue,D=me;return S(),F(ye,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":c.isDrawerOpen,"onUpdate:modelValue":A},{default:i(()=>[a(w,{title:c.company!=null?"Editar Empresa":"Agregar Empresa",onCancel:b},null,8,["title"]),a(H),a(e(ce),{options:{wheelPropagation:!1}},{default:i(()=>[a(L,{flat:""},{default:i(()=>[a(Q,null,{default:i(()=>[a(Ve,{ref_key:"refForm",ref:d,modelValue:e(m),"onUpdate:modelValue":l[9]||(l[9]=t=>y(m)?m.value=t:null),onSubmit:oe(q,["prevent"])},{default:i(()=>[a(ve,null,{default:i(()=>[a(V,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(o).nombre,"onUpdate:modelValue":l[0]||(l[0]=t=>e(o).nombre=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"Nombre",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(o).cif,"onUpdate:modelValue":l[1]||(l[1]=t=>e(o).cif=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"C.I.F",placeholder:""},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(o).ccc,"onUpdate:modelValue":l[2]||(l[2]=t=>e(o).ccc=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"CCC",placeholder:""},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(M,{modelValue:e(o).id_tipo,"onUpdate:modelValue":l[3]||(l[3]=t=>e(o).id_tipo=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"Tipo",placeholder:"Selecciona un tipo de empresa",items:c.tipos,"item-value":"id","item-title":"nombre"},null,8,["modelValue","rules","items"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(M,{modelValue:e(o).provincia_id,"onUpdate:modelValue":l[4]||(l[4]=t=>e(o).provincia_id=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"Provincia",placeholder:"Selecciona una provincia",items:c.provincias,"item-value":"id","item-title":"nombre"},null,8,["modelValue","rules","items"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(o).localidad,"onUpdate:modelValue":l[5]||(l[5]=t=>e(o).localidad=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"localidad",placeholder:""},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(U,{modelValue:e(o).codigo_postal,"onUpdate:modelValue":l[6]||(l[6]=t=>e(o).codigo_postal=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"Codigo postal",placeholder:""},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(D,{modelValue:e(o).created_at,"onUpdate:modelValue":l[7]||(l[7]=t=>e(o).created_at=t),label:"Fecha alta",disabled:"",config:e(fe)},null,8,["modelValue","config"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(ge,{modelValue:e(o).direccion,"onUpdate:modelValue":l[8]||(l[8]=t=>e(o).direccion=t),rules:["requiredValidator"in r?r.requiredValidator:e(v)],label:"Direccion",placeholder:""},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:i(()=>[a(B,{type:"submit",class:"me-4"},{default:i(()=>l[10]||(l[10]=[T(" Aceptar ")])),_:1}),a(B,{type:"reset",variant:"outlined",color:"error",onClick:b},{default:i(()=>l[11]||(l[11]=[T(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},De={class:"app-user-search-filter d-flex align-center"},Ce={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},_e={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},ke={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},Ue={class:"d-flex gap-x-2 align-center me-2"},ga={__name:"index",async setup(I){let f,c;const g=ie("userData"),o=u(""),m=u(10),d=u(1),b=u(),q=u(),h=n=>{var s,k;d.value=n.page,b.value=(s=n.sortBy[0])==null?void 0:s.key,q.value=(k=n.sortBy[0])==null?void 0:k.order},A=[{title:"Empresa",key:"nombre"},{title:"URL",key:"url"},{title:"Fecha alta",key:"fecha_alta"},{title:"Actions",key:"actions",sortable:!1}],r=([f,c]=J(()=>E("/get-provincias",{method:"GET"})),f=await f,c(),f),l=R(()=>r),w=([f,c]=J(()=>E("/get-tipo-empresas",{method:"GET"})),f=await f,c(),f),D=R(()=>w),t=u(!1),C=u(null),z=u([]),_=u(0),P=u(!1),O=async()=>{try{const n=await E("/empresas",{method:"GET",params:{search:o.value,itemsPerPage:m.value,page:d.value,sortBy:b.value,orderBy:q.value}});z.value=n.data,_.value=n.total}catch(n){console.error(n)}},K=async n=>{await E("/save-empresa",{method:"POST",body:n.value}),O()},W=async n=>{await E(`/delete-empresa/${n}`,{method:"GET"}),O()},X=()=>{t.value=!0,C.value=null},Y=n=>{t.value=!0,C.value=n},Z=n=>{C.value=n,P.value=!0};return re(O),$([m,b,q,d,o],()=>{O()}),$(t,async n=>{n||(C.value={})}),(n,s)=>{var G;const k=de("IconBtn"),ee=pe;return S(),se("section",null,[a(L,{title:"Filtros",class:"mb-6"},{default:i(()=>[a(Q,{class:"d-flex flex-wrap gap-4"},{default:i(()=>[x("div",De,[a(U,{modelValue:e(o),"onUpdate:modelValue":s[0]||(s[0]=p=>y(o)?o.value=p:null),placeholder:"Buscar",density:"compact",class:"me-4"},null,8,["modelValue"]),e(g).id_role==1?(S(),F(B,{key:0,onClick:X},{default:i(()=>s[8]||(s[8]=[T(" Agregar nueva empresa ")])),_:1})):j("",!0)])]),_:1}),a(be,{"items-per-page":e(m),"onUpdate:itemsPerPage":s[4]||(s[4]=p=>y(m)?m.value=p:null),page:e(d),"onUpdate:page":s[5]||(s[5]=p=>y(d)?d.value=p:null),items:e(z),"item-value":"id","items-length":e(_),headers:A,class:"text-no-wrap rounded-0","onUpdate:options":h},{"item.actions":i(({item:p})=>[e(g).id_role==1?(S(),F(k,{key:0,size:"small",onClick:ae=>Z(p)},{default:i(()=>[a(N,{icon:"ri-delete-bin-7-line"})]),_:2},1032,["onClick"])):j("",!0),a(k,{size:"small",onClick:ae=>Y(p)},{default:i(()=>[a(N,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["onClick"]),a(k,{size:"small",to:{name:"apps-company-view-id",params:{id:p.id}}},{default:i(()=>[a(N,{icon:"ri-eye-line"})]),_:2},1032,["to"])]),bottom:i(()=>[a(H),x("div",Ce,[x("div",_e,[s[9]||(s[9]=T(" Filas por pÃ¡gina: ")),a(M,{modelValue:e(m),"onUpdate:modelValue":s[1]||(s[1]=p=>y(m)?m.value=p:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),x("p",ke,ne(("paginationMeta"in n?n.paginationMeta:e(le))({page:e(d),itemsPerPage:e(m)},e(_))),1),x("div",Ue,[a(B,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:e(d)<=1,onClick:s[2]||(s[2]=p=>e(d)<=1?d.value=1:d.value--)},null,8,["disabled"]),a(B,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:e(d)>=Math.ceil(e(_)/e(m)),onClick:s[3]||(s[3]=p=>e(d)>=Math.ceil(e(_)/e(m))?d.value=Math.ceil(e(_)/e(m)):d.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),a(we,{isDrawerOpen:e(t),"onUpdate:isDrawerOpen":s[6]||(s[6]=p=>y(t)?t.value=p:null),onCompanyData:K,provincias:e(l),company:e(C),tipos:e(D)},null,8,["isDrawerOpen","provincias","company","tipos"]),a(ee,{isDialogVisible:e(P),"onUpdate:isDialogVisible":s[7]||(s[7]=p=>y(P)?P.value=p:null),id:(G=e(C))==null?void 0:G.id,onSubmit:W},null,8,["isDialogVisible","id"])])}}};export{ga as default};
