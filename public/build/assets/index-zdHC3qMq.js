import{_ as L}from"./ConfirmDialog-CY-Jws0o.js";import{aT as B,r as o,w as E,o as $,f as M,e as l,b as e,n,ag as S,am as P,af as z,v as y,ak as G,a6 as R,I as J,c as Q,aM as j,d as H,a0 as N,x as K,a as W}from"./main-XhKa_9tU.js";import{r as X}from"./validators-CrSGMxiT.js";import{_ as Y}from"./AppDrawerHeaderSection-C-4ZcHAe.js";import{P as Z}from"./vue3-perfect-scrollbar.esm-CvKV9PJx.js";import{a as O}from"./api-DoG2ksOD.js";import{V as ee}from"./VDivider-C4lH0ooT.js";import{V as A}from"./VCard-Eaj0dfV-.js";import{V as U}from"./VCardText-B_O88IhU.js";import{V as ae}from"./VForm-BH9swDaI.js";import{V as te,a as T}from"./VRow-CFasNknx.js";import{V as I}from"./VTextField-DG88OKPn.js";import{V as oe}from"./VNavigationDrawer-RrJ7CuuC.js";import{V as le}from"./VDataTable-CrfrFXcg.js";import"./VDialog-0i2MyK-R.js";import"./dialog-transition-B2pKVHb-.js";import"./helpers-DK5QwNv0.js";import"./VSpacer-BCVgdAwd.js";/* empty css              */import"./VAvatar-BgIHgX1n.js";import"./VImg-BWevH90G.js";import"./index-C3NwvUM2.js";import"./index-9rIf2CJL.js";import"./form-BsyuclTd.js";/* empty css                   */import"./VCounter-zOsFyD3o.js";import"./VField-CvyOoNAD.js";import"./VInput-DCf9aRQz.js";import"./ssrBoot-BEJ69UV0.js";import"./VSelect-BBvcpHuX.js";import"./VList-DjfFgeFe.js";import"./VMenu-D_PRx64v.js";import"./VCheckboxBtn-CKjjSpr9.js";import"./VSelectionControl-BXoDVL8N.js";import"./VChip-BBE3Enfq.js";import"./VPagination-64W-UBzK.js";import"./VTable-Cb5v_Kut.js";import"./filter-Bi6u83zm.js";const re={__name:"AddNewStoreDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},item:{type:Object,default:()=>null}},emits:["update:isDrawerOpen","refresh"],setup(h,{emit:V}){const w=h,f=B(),d=V,v=o({}),c=o({id:null,nombre:""}),m=o(!1),u=o(),s=()=>{v.value={},d("update:isDrawerOpen",!1)},D=async()=>{try{v.value={};const t=await O("/savetienda",{method:"POST",body:c.value});f.success(`Localización ${t.was_created?"creada":"actualizada"} con éxito`),d("refresh",t),d("update:isDrawerOpen",!1)}catch(t){f.error("Algo ha salido mal"),t.status==422&&(v.value=t.response._data.errors)}},x=async()=>{var b;const{valid:t,errors:i}=await((b=u.value)==null?void 0:b.validate());t&&await D()},C=()=>{G(()=>{var t,i;(t=u.value)==null||t.reset(),(i=u.value)==null||i.resetValidation()}),c.value={id:null,nombre:""}};E(()=>w.item,()=>{w.item!=null?c.value=JSON.parse(JSON.stringify(w.item)):C()},{immediate:!0});const k=t=>{d("update:isDrawerOpen",t)};return(t,i)=>{const b=Y;return $(),M(oe,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":w.isDrawerOpen,"onUpdate:modelValue":k},{default:l(()=>[e(b,{title:w.item!=null?"Editar localización":"Agregar localización",onCancel:s},null,8,["title"]),e(ee),e(n(Z),{options:{wheelPropagation:!1}},{default:l(()=>[e(A,{flat:""},{default:l(()=>[e(U,null,{default:l(()=>[e(ae,{ref_key:"refForm",ref:u,modelValue:n(m),"onUpdate:modelValue":i[1]||(i[1]=g=>S(m)?m.value=g:null),onSubmit:P(x,["prevent"])},{default:l(()=>[e(te,null,{default:l(()=>[e(T,{cols:"12"},{default:l(()=>[e(I,{modelValue:n(c).nombre,"onUpdate:modelValue":i[0]||(i[0]=g=>n(c).nombre=g),rules:["requiredValidator"in t?t.requiredValidator:n(X)],label:"Nombre",placeholder:"Nombre de la localización"},null,8,["modelValue","rules"])]),_:1}),e(T,{cols:"12"},{default:l(()=>[e(z,{type:"submit",class:"me-4"},{default:l(()=>i[2]||(i[2]=[y(" Guardar ")])),_:1}),e(z,{type:"reset",variant:"outlined",color:"error",onClick:s},{default:l(()=>i[3]||(i[3]=[y(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ie={class:"app-user-search-filter d-flex align-center"},Je={__name:"index",setup(h){B();const V=o("");o(10),o(1),o(),o();const w=[{title:"Nombre",key:"nombre"},{title:"Acciones",key:"actions",sortable:!1}],f=o(!1),d=o(!1),v=o("success"),c=o(""),m=o(!1),u=o(null),s=o([]),D=o(0),x=async()=>{try{const a=await O("/gettiendas",{method:"GET"});s.value=a,D.value=a.length}catch(a){console.error(a),v.value="error",c.value="Error al cargar las localizaciones",d.value=!0}},C=a=>{if(a.was_created)s.value.unshift(a.tienda),D.value=s.value.length;else{let r=s.value.findIndex(_=>_.id==a.tienda.id);r>-1&&(s.value[r]=a.tienda)}},k=async()=>{try{const a=await O(`/deletetienda/${u.value.id}`,{method:"GET"});let r=s.value.findIndex(_=>_.id==u.value.id);r>-1&&(s.value.splice(r,1),D.value=s.value.length),f.value=!1,v.value="success",c.value="Localización eliminada con éxito",d.value=!0}catch{v.value="error",c.value="Error al eliminar la localización",d.value=!0}},t=()=>{m.value=!0,u.value=null},i=a=>{m.value=!0,u.value=a},b=a=>{u.value=a,f.value=!0},g=R(()=>V.value?s.value.filter(a=>a.nombre.toLowerCase().includes(V.value.toLowerCase())):s.value);return J(x),E(m,async a=>{a||(u.value={})}),(a,r)=>{const _=W("IconBtn"),q=L;return $(),Q("section",null,[e(A,{title:"Localizaciones",class:"mb-6"},{default:l(()=>[e(U,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[H("div",ie,[e(I,{modelValue:n(V),"onUpdate:modelValue":r[0]||(r[0]=p=>S(V)?V.value=p:null),placeholder:"Buscar localización",density:"compact",class:"me-4"},null,8,["modelValue"]),e(z,{onClick:t},{default:l(()=>r[4]||(r[4]=[y(" Agregar nueva localización ")])),_:1})])]),_:1}),e(le,{items:n(g),"item-value":"id",headers:w,class:"text-no-wrap rounded-0"},{"item.actions":l(({item:p})=>[e(_,{size:"small",onClick:F=>b(p)},{default:l(()=>[e(N,{icon:"ri-delete-bin-7-line"})]),_:2},1032,["onClick"]),e(_,{size:"small",onClick:F=>i(p)},{default:l(()=>[e(N,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["onClick"])]),_:1},8,["items"])]),_:1}),e(re,{isDrawerOpen:n(m),"onUpdate:isDrawerOpen":r[1]||(r[1]=p=>S(m)?m.value=p:null),item:n(u),onRefresh:C},null,8,["isDrawerOpen","item"]),e(q,{isDialogVisible:n(f),"onUpdate:isDialogVisible":r[2]||(r[2]=p=>S(f)?f.value=p:null),confirmationQuestion:"¿Está seguro que desea eliminar la localización seleccionada?",onConfirm:k},null,8,["isDialogVisible"]),e(j,{location:"top end",modelValue:n(d),"onUpdate:modelValue":r[3]||(r[3]=p=>S(d)?d.value=p:null),color:n(v)},{default:l(()=>[y(K(n(c)),1)]),_:1},8,["modelValue","color"])])}}};export{Je as default};
