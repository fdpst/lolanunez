import{p as Me}from"./paginationMeta-BbY5dJ0C.js";import{_ as fe}from"./AppDateTimePicker-Co0_bleo.js";import{d as ge}from"./baseDateSelectFormat-J9P8RDVV.js";import{h as le}from"./moment-C5S46NFB.js";import{_ as ve}from"./AppDrawerHeaderSection-Xz2ghZt5.js";import{r as o,w as W,o as F,f as T,e as l,b as e,n as a,ag as f,am as Pe,af as b,v as g,ak as Fe,aM as be,a as ne,B as oe,d as x,x as K,at as $e,I as Ae,a6 as pe,c as Be,z as ce,a0 as te}from"./main-DXTHM_Z4.js";import{P as Ve}from"./vue3-perfect-scrollbar.esm-CQjiEb9s.js";import{V as X}from"./VDivider-CVdsTcIK.js";import{V as Z,b as Te,d as Ee}from"./VCard-BBjecQUS.js";import{V as H}from"./VCardText-DGP4d7zZ.js";import{V as ye}from"./VForm-B4Tyf17S.js";import{V as se,a as _}from"./VRow-U9BCKMf6.js";import{V as Se}from"./VSelect-DDGWU2xG.js";import{V as _e}from"./VNavigationDrawer-CS8amoRg.js";import{$ as U}from"./api-CWHLgCqw.js";import{_ as je}from"./DialogCloseBtn-vF1tbmc_.js";import{V as Ne}from"./VDialog-BXZSKyZJ.js";import{_ as Ie}from"./DeleteDialog-BWKI8zwF.js";import{V as Q}from"./VAutocomplete-BrZJDE2O.js";import{V as Ye}from"./VSpacer-B26ty9bD.js";import{V as ze}from"./VDataTableServer-CO9gBG3B.js";import"./VField-B2YWi8oL.js";import"./form-ijrz4ipO.js";import"./VInput-BZH6jw62.js";import"./es-B-Pf7tX4.js";import"./VAvatar-QubjHI1z.js";import"./VImg-DTTLi8N3.js";/* empty css              */import"./VTextField-BfMLnCIA.js";/* empty css                   */import"./VCounter-CfjE-LQa.js";import"./VList-5epMYaPo.js";import"./ssrBoot-BzQpit4r.js";import"./dialog-transition-CqXIoDZd.js";import"./VMenu-D1AAVsYt.js";import"./VCheckboxBtn-DNkfUJpf.js";import"./VSelectionControl-DqCfd3An.js";import"./VChip-CoWdbaPm.js";import"./index-D1tqMycq.js";import"./index-9rIf2CJL.js";import"./filter-B81R-Kvh.js";import"./VDataTable-Dhru72M2.js";import"./VPagination-EsQETAJ-.js";import"./VTable-DROJbQhe.js";const qe={__name:"AddNewSigningDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},signing:{type:Object,default:()=>null},users:{type:Array,default:()=>[]}},emits:["update:isDrawerOpen","signingData"],setup($,{emit:h}){const V=$;o("false");const w=h,p=o({id:null,usuario_id:null,fecha:"",hora:""}),d=o(!1),i=o(),y=()=>{w("update:isDrawerOpen",!1)},D=()=>{var c;(c=i.value)==null||c.validate().then(({valid:m})=>{m&&(w("signingData",p),w("update:isDrawerOpen",!1),Fe(()=>{var v,r;(v=i.value)==null||v.reset(),(r=i.value)==null||r.resetValidation()}))})},A=()=>{p.value={id:null,nombre:""}};W(()=>{V.signing!=null?p.value=V.signing:A()});const k=c=>{w("update:isDrawerOpen",c)};return(c,m)=>{const v=ve,r=fe;return F(),T(_e,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":V.isDrawerOpen,"onUpdate:modelValue":k},{default:l(()=>[e(v,{title:V.signing!=null?"Editar Fichaje":"Agregar Fichaje",onCancel:y},null,8,["title"]),e(X),e(a(Ve),{options:{wheelPropagation:!1}},{default:l(()=>[e(Z,{flat:""},{default:l(()=>[e(H,null,{default:l(()=>[e(ye,{ref_key:"refForm",ref:i,modelValue:a(d),"onUpdate:modelValue":m[3]||(m[3]=S=>f(d)?d.value=S:null),onSubmit:Pe(D,["prevent"])},{default:l(()=>[e(se,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(Se,{modelValue:a(p).usuario_id,"onUpdate:modelValue":m[0]||(m[0]=S=>a(p).usuario_id=S),label:"Usuario",placeholder:"Selecciona un usuario",items:$.users,"item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[e(r,{config:a(ge),modelValue:a(p).fecha,"onUpdate:modelValue":m[1]||(m[1]=S=>a(p).fecha=S),label:"Fecha",placeholder:"Selecciona una fecha"},null,8,["config","modelValue"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[e(r,{modelValue:a(p).hora,"onUpdate:modelValue":m[2]||(m[2]=S=>a(p).hora=S),label:"Hora",placeholder:"Selecciona una hora",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[e(b,{type:"submit",class:"me-4"},{default:l(()=>m[4]||(m[4]=[g(" Aceptar ")])),_:1}),e(b,{type:"reset",variant:"outlined",color:"error",onClick:y},{default:l(()=>m[5]||(m[5]=[g(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},He={__name:"SignDrawer",props:{isSignDrawerOpen:{type:Boolean,required:!0}},emits:["update:isSignDrawerOpen","signData"],setup($,{emit:h}){const V=$;o(0);const w=o({penColor:"rgb(0, 0, 0)",backgroundColor:"rgb(255,255,255)"}),p=o(!1),d=o(!1),i=o(null),y=v=>{let r=i.value.save(v);A(r)},D=()=>{i.value.clear()},A=async v=>{try{const r=await U("/save-firma",{method:"POST",body:{archivo:v}});p.value=!0,D(),c()}catch(r){r.response.status==403&&p(r.response._data)}},k=h,c=()=>{D(),k("update:isSignDrawerOpen",!1)},m=v=>{k("update:isSignDrawerOpen",v)};return(v,r)=>{const S=ve,C=ne("Vue3Signature");return F(),T(_e,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":V.isSignDrawerOpen,"onUpdate:modelValue":m},{default:l(()=>[e(S,{title:"Firmar",onCancel:c}),e(X),e(a(Ve),{options:{wheelPropagation:!1}},{default:l(()=>[e(Z,{flat:""},{default:l(()=>[e(H,null,{default:l(()=>[e(ye,null,{default:l(()=>[e(se,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(C,{ref_key:"signature1",ref:i,sigOption:a(w),w:"400px",h:"250px",disabled:a(d),class:"example"},null,8,["sigOption","disabled"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[e(b,{onClick:y,class:"me-4"},{default:l(()=>r[1]||(r[1]=[g(" Aceptar ")])),_:1}),e(b,{onClick:D,class:"me-4"},{default:l(()=>r[2]||(r[2]=[g(" Reiniciar ")])),_:1}),e(b,{type:"reset",variant:"outlined",color:"error",onClick:c},{default:l(()=>r[3]||(r[3]=[g(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(be,{modelValue:a(p),"onUpdate:modelValue":r[0]||(r[0]=u=>f(p)?p.value=u:null),location:"top end",color:"success"},{default:l(()=>r[4]||(r[4]=[g(" Firma enviada con exito ")])),_:1},8,["modelValue"])]),_:1},8,["model-value"])}}},Re={__name:"SignModal",props:{lastSign:{type:String,required:!0,default:()=>null},isSignModalOpen:{type:Boolean,required:!0}},emits:["submit","update:isSignModalOpen"],setup($,{emit:h}){const V=$,w=o({penColor:"rgb(0, 0, 0)",backgroundColor:"rgb(255,255,255)"}),p=o("Esta es la firma configurada, ¿desea continuar o firmar nuevamente?"),d=o(!0),i=o(null),y=o(!0),D=C=>{let u=i.value.save(C);c(u)},A=()=>{y.value=!1,d.value=!1,i.value.clear()},k=oe("userData"),c=async C=>{try{const u=await U(`/save-firma-empresa/${k.value.id_empresa}`,{method:"POST",body:{archivo:C}});m("submit")}catch(u){u.response.status==403&&alert(u.response._data)}},m=h,v=C=>{m("update:isSignModalOpen",C)},r=()=>{m("update:isSignModalOpen",!1)},S=()=>{m("submit")};return W(()=>{V.lastSign&&i.value?(i.value.fromDataURL(V.lastSign),p.value="Esta es la firma configurada, ¿desea continuar o firmar nuevamente?",d.value=!0,y.value=!0):(p.value="Por favor introduzca su firma",d.value=!1,y.value=!1)}),(C,u)=>{const B=je,E=ne("Vue3Signature");return F(),T(Ne,{width:"550","model-value":V.isSignModalOpen,"onUpdate:modelValue":v},{default:l(()=>[e(Z,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(Te,{class:"text-center"},{default:l(()=>[u[0]||(u[0]=g(" Aviso ")),e(B,{variant:"text",size:"default",onClick:r})]),_:1}),e(H,{class:"text-center"},{default:l(()=>[x("p",null,K(a(p)),1),u[1]||(u[1]=x("br",null,null,-1)),e(E,{ref_key:"signature1",ref:i,sigOption:a(w),w:"400px",h:"230px",disabled:a(d),class:"example"},null,8,["sigOption","disabled"])]),_:1}),e(Ee,{class:"justify-center"},{default:l(()=>[a(y)?(F(),T(b,{key:0,onClick:S,color:"primary",variant:"outlined"},{default:l(()=>u[2]||(u[2]=[g("Continuar")])),_:1})):(F(),T(b,{key:1,onClick:D,color:"primary",variant:"outlined",class:"me-4"},{default:l(()=>u[3]||(u[3]=[g("Aceptar")])),_:1})),e(b,{onClick:A,class:"me-4",variant:"outlined"},{default:l(()=>u[4]||(u[4]=[g("Firmar de nuevo")])),_:1}),e(b,{onClick:r,color:"secondary",variant:"outlined"},{default:l(()=>u[5]||(u[5]=[g("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ge={class:"custom-column"},Je=["href"],Le={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},Qe={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},Ke={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},We={class:"d-flex gap-x-2 align-center me-2"},za={__name:"index",async setup($){let h,V;const w=o(ge),p=o(""),d=o(10),i=o(1),y=o(),D=o();o(0),o({penColor:"rgb(0, 0, 0)",backgroundColor:"rgb(255,255,255)"}),o(!1);const A=["2024","2025"],k=o("2024"),c=o(parseInt(le().format("MM"))),m=o([{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}]),v=n=>{i.value=n.page,y.value=n.sortBy[0]?n.sortBy[0].key:null,D.value=n.sortBy[0]?n.sortBy[0].order:null},r=([h,V]=$e(()=>U("/get-usuarios-empleados-all",{method:"POST"})),h=await h,V(),h),S=async()=>{try{const n=await U("/enviar-recordatorio-firma",{method:"GET"});console.log(n)}catch(n){console.error(n)}},C=[{title:"Usuario",key:"nombre",role:[1,2]},{title:"Fecha",key:"fecha_fichaje",role:[1,2,3]},{title:"Hora",key:"hora",role:[1,2,3]},{title:"IP",key:"ip_add",role:[1,2]},{title:"S.O.",key:"os",role:[1,2]},{title:"Navegador",key:"browser",role:[1,2]},{title:"Direccion",key:"address",class:"custom-column-header",role:[1,2]},{title:"Actions",key:"actions",sortable:!1,role:[1,2]}],u=o(!1),B=o(!1),E=o(!1),ie=o(""),R=o(!1),re=o(null),j=o(!1),N=o(null),ue=o([]),I=o(0),Y=o(le().startOf("month").format("YYYY-MM-DD")),z=o(le().endOf("month").format("YYYY-MM-DD")),M=oe("userData"),P=o(null),G=o(null),J=o(!1),L=async()=>{try{P.value==null&&M.value.id_role==3&&(P.value=oe("userData").value.id);const n=await U(P.value?`/get-fichajes-by-user/${P.value}`:"/get-fichajes-by-user",{method:"POST",body:{itemsPerPage:d.value,page:i.value,sortBy:y.value,orderBy:D.value,fechaInicio:Y.value,fechaFin:z.value}});ue.value=n.data,I.value=n.total}catch(n){console.error(n)}},we=async n=>{await U("/save-fichaje",{method:"POST",body:n.value}),L()},De=async n=>{await U(`/delete-fichaje/${n}`,{method:"GET"}),L()},ke=()=>{j.value=!0,N.value=null},he=n=>{j.value=!0,N.value=n},Ce=n=>{N.value=n,J.value=!0},Oe=()=>{E.value=!1,B.value=!1,de()},de=async()=>{if(E.value==!0)return B.value=!0;try{const n=await U("/crear-pdf-fichajes",{method:"POST",body:{year:k.value,month:c.value,usuario:G.value}});E.value=!1;const t=n.url_name,q=`${window.location.origin}/storage/fichajes/${t}`,O=document.createElement("a");O.href=q,O.target="_blank",O.download="",document.body.appendChild(O),O.click(),document.body.removeChild(O),me()}catch(n){n.status==403&&(R.value=!0,re.value="Firma de empresa no encontrada")}};Ae(L),W([d,y,D,i,p,P,Y,z],()=>{L()}),W(j,async n=>{n||(N.value={})});const me=async()=>{try{const n=await U(`/get-firma-empresa/${M.value.id_empresa}`,{method:"GET"});if(n=="")return E.value=!0;ie.value=n}catch(n){console.log(n)}};M.value.id_role==2&&me();const ee=pe(()=>((M.value.id_role==1||M.value.id_role==2)&&r.unshift({id:null,name:"Todos"}),r)),xe=pe(()=>C.filter(n=>n.role.includes(M.value.id_role)));return(n,t)=>{var O;const ae=fe,q=ne("IconBtn");return F(),Be("section",null,[e(be,{modelValue:a(R),"onUpdate:modelValue":t[0]||(t[0]=s=>f(R)?R.value=s:null),location:"top end",color:"error"},{default:l(()=>[g(K(a(re)),1)]),_:1},8,["modelValue"]),e(Z,{title:"Filtros",class:"mb-6"},{default:l(()=>[e(H,null,{default:l(()=>[e(se,null,{default:l(()=>[a(M).id_role!=3?(F(),T(_,{key:0,cols:"12",sm:"3"},{default:l(()=>[e(a(Q),{modelValue:a(P),"onUpdate:modelValue":t[1]||(t[1]=s=>f(P)?P.value=s:null),label:"Usuario",placeholder:"Selecciona un usuario",items:a(ee),"item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),_:1})):ce("",!0),e(_,{cols:"12",sm:"3"},{default:l(()=>[e(ae,{config:a(w),modelValue:a(Y),"onUpdate:modelValue":t[2]||(t[2]=s=>f(Y)?Y.value=s:null),label:"Fecha de inicio",placeholder:"Selecciona una fecha"},null,8,["config","modelValue"])]),_:1}),e(_,{cols:"12",sm:"3"},{default:l(()=>[e(ae,{config:a(w),modelValue:a(z),"onUpdate:modelValue":t[3]||(t[3]=s=>f(z)?z.value=s:null),label:"Fecha de fin",placeholder:"Selecciona una fecha"},null,8,["config","modelValue"])]),_:1}),e(_,{cols:"12",sm:"3"},{default:l(()=>[e(b,{onClick:ke,class:"me-2 mt-1"},{default:l(()=>t[16]||(t[16]=[g(" Agregar nuevo fichaje ")])),_:1})]),_:1})]),_:1})]),_:1}),e(X),t[20]||(t[20]=x("h3",{class:"mt-2 ml-4"},"Exportar a PDF",-1)),a(M).id_role!=3?(F(),T(H,{key:0,class:"d-flex flex-wrap"},{default:l(()=>[e(_,{cols:"12",sm:"3",class:"pl-0"},{default:l(()=>[e(a(Q),{modelValue:a(G),"onUpdate:modelValue":t[4]||(t[4]=s=>f(G)?G.value=s:null),label:"Usuario",placeholder:"Selecciona un usuario",items:a(ee),"item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),_:1}),e(_,{cols:"12",sm:"2",class:"pl-0"},{default:l(()=>[e(a(Q),{modelValue:a(k),"onUpdate:modelValue":t[5]||(t[5]=s=>f(k)?k.value=s:null),label:"Año",placeholder:"Selecciona un año",items:A},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"3"},{default:l(()=>[e(a(Q),{modelValue:a(c),"onUpdate:modelValue":t[6]||(t[6]=s=>f(c)?c.value=s:null),label:"Mes",placeholder:"Selecciona un mes",items:a(m),"item-value":"value","item-title":"label"},null,8,["modelValue","items"])]),_:1}),e(Ye),e(b,{onClick:S,class:"me-2 mt-4"},{default:l(()=>t[17]||(t[17]=[g(" Enviar recordatorio ")])),_:1}),e(b,{variant:"outlined",color:"secondary","prepend-icon":"ri-file-pdf-2-line",onClick:de,class:"mt-4"},{default:l(()=>t[18]||(t[18]=[g(" PDF ")])),_:1})]),_:1})):ce("",!0),e(ze,{"items-per-page":a(d),"onUpdate:itemsPerPage":t[10]||(t[10]=s=>f(d)?d.value=s:null),page:a(i),"onUpdate:page":t[11]||(t[11]=s=>f(i)?i.value=s:null),items:a(ue),"item-value":"id","items-length":a(I),headers:a(xe),class:"text-no-wrap rounded-0","onUpdate:options":v},{"item.address":l(({item:s})=>[x("div",Ge,K(s.address),1)]),"item.actions":l(({item:s})=>[e(q,{size:"small"},{default:l(()=>[x("a",{target:"__blank",href:`https://www.google.es/maps?q=${s.lat} ${s.lon}`,style:{color:"rgb(var(--v-theme--secondary))"}},[e(te,{icon:"ri-map-pin-line",title:"Mapa"})],8,Je)]),_:2},1024),e(q,{size:"small",onClick:Ue=>Ce(s),title:"Eliminar"},{default:l(()=>[e(te,{icon:"ri-delete-bin-7-line"})]),_:2},1032,["onClick"]),e(q,{size:"small",onClick:Ue=>he(s)},{default:l(()=>[e(te,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["onClick"])]),bottom:l(()=>[e(X),x("div",Le,[x("div",Qe,[t[19]||(t[19]=g(" Filas por página: ")),e(Se,{modelValue:a(d),"onUpdate:modelValue":t[7]||(t[7]=s=>f(d)?d.value=s:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),x("p",Ke,K(("paginationMeta"in n?n.paginationMeta:a(Me))({page:a(i),itemsPerPage:a(d)},a(I))),1),x("div",We,[e(b,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:a(i)<=1,onClick:t[8]||(t[8]=s=>a(i)<=1?i.value=1:i.value--)},null,8,["disabled"]),e(b,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:a(i)>=Math.ceil(a(I)/a(d)),onClick:t[9]||(t[9]=s=>a(i)>=Math.ceil(a(I)/a(d))?i.value=Math.ceil(a(I)/a(d)):i.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","page","items","items-length","headers"])]),_:1}),e(qe,{isDrawerOpen:a(j),"onUpdate:isDrawerOpen":t[12]||(t[12]=s=>f(j)?j.value=s:null),signing:a(N),users:a(ee),onSigningData:we},null,8,["isDrawerOpen","signing","users"]),e(Ie,{isDialogVisible:a(J),"onUpdate:isDialogVisible":t[13]||(t[13]=s=>f(J)?J.value=s:null),id:(O=a(N))==null?void 0:O.id,onSubmit:De},null,8,["isDialogVisible","id"]),e(He,{isSignDrawerOpen:a(u),"onUpdate:isSignDrawerOpen":t[14]||(t[14]=s=>f(u)?u.value=s:null)},null,8,["isSignDrawerOpen"]),e(Re,{isSignModalOpen:a(B),"onUpdate:isSignModalOpen":t[15]||(t[15]=s=>f(B)?B.value=s:null),lastSign:a(ie),onSubmit:Oe},null,8,["isSignModalOpen","lastSign"])])}}};export{za as default};
