import{aT as ke,o as v,f as q,e as a,b as e,v as V,al as Pe,n as k,r as s,aU as Qe,w as W,ak as Be,c as H,d as S,x as E,F as z,i as ie,K as Ae,am as De,a0 as qe,z as j,y as ye,aK as We,aL as Xe,af as x,ag as he,A as Ze,a6 as re,I as el}from"./main-BwDGDDDW.js";import{V as se,b as Ve,d as ll}from"./VCard-Cpw0jw9u.js";import{V as ae}from"./VCardText-BKkdmkn-.js";import{V as Ce}from"./VDialog-5yhkawgU.js";import{$ as $e,a as de}from"./api-CjWrXaZL.js";import{h as D}from"./moment-C5S46NFB.js";import{_ as al,l as Q}from"./lodash-BDoZwyum.js";import{V as Re}from"./VChip-CXCzEWTC.js";import{r as Ie,e as tl}from"./validators-CrSGMxiT.js";import{_ as ol}from"./AppDateTimePicker-BgncYox4.js";import{_ as rl}from"./ConfirmDialog-BcB1qS-q.js";import{_ as Ge}from"./DialogCloseBtn-B0aYGOTk.js";import{a as nl,b as il}from"./VList-CLtMWoGj.js";import{V as Ye}from"./VAutocomplete-DSXORfQB.js";import{V as Ke}from"./VForm-DbaU_ACV.js";import{V as ne,a as M}from"./VRow-DJH2tZVu.js";import{V as ve}from"./VTextField-DqZOZREA.js";import{V as ze}from"./VTextarea-Ugpn_Hk5.js";import"./VAvatar-DYn3is-W.js";import"./VImg-BYy41-F9.js";import"./dialog-transition-GiYjLY5n.js";import"./index-D8byVCHt.js";import"./index-9rIf2CJL.js";import"./helpers-DK5QwNv0.js";import"./VField-5sqsN37e.js";import"./form-BEvPHhJ7.js";import"./VInput-CVFVwJKu.js";import"./ssrBoot-B7QpyNAy.js";import"./VDivider-PVfbuN4-.js";import"./VSelect-Cdsnm3mB.js";import"./VMenu-BWP2lKbi.js";import"./VCheckboxBtn-CuvLREeJ.js";import"./VSelectionControl-D0_t5DTC.js";import"./filter-B9tzeaPh.js";/* empty css              *//* empty css                   */import"./VCounter-IA5S7b1U.js";const sl={__name:"dialogLoader",setup(f){const _=ke();return(p,u)=>(v(),q(Ce,{persistent:"",modelValue:k(_).loader,"onUpdate:modelValue":u[0]||(u[0]=h=>k(_).loader=h),width:"300"},{default:a(()=>[e(se,{color:"primary",width:"300"},{default:a(()=>[e(ae,{class:"pt-3 text-white"},{default:a(()=>[u[1]||(u[1]=V(" Cargando ")),e(Pe,{indeterminate:"",class:"mt-4",color:"#fff"})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ul=()=>{const f=s([]),_=s(null),p=s([]),u=s([]),h=s([]);return{tienda:_,tiendas:f,empleados:p,servicios:u,clientes:h,getTiendas:async()=>{try{const w=await $e("/get-config",{method:"GET"});f.value=w.tiendas,_.value=w.config.tienda_id}catch(w){console.error("Error obteniendo tiendas:",w)}},getData:async(w,C)=>{try{const $=await de(`/getdata/${w}/${C}`,{method:"GET"});p.value=$.empleados,u.value=$.servicios,h.value=$.clientes}catch($){console.error("Error obteniendo empleados:",$)}}}},P=Qe({on(f,_){document.addEventListener(f,p=>_(p.detail))},emit(f,_){document.dispatchEvent(new CustomEvent(f,{detail:_}))},off(f,_){document.removeEventListener(f,_)}}),dl={class:"empleado-nombre"},cl=["onClick","data-dia","data-empleado","data-hora"],ml=["onClick","onDragstart"],pl={style:{"text-transform":"capitalize"}},fl={__name:"EmpleadoComponent",props:{intervalos:Array,empleado:Object,citas:Array,horario:Object,dia_actual:String,interval_height:Number,fechas:Array,type:String,app_tienda_id:[String,Number]},setup(f){const _=f,p=s([]);var u=s({});const h=s({}),y=s({}),O=s({}),w=(n,b)=>{if(_.fechas&&_.fechas.length>0)return u.value={},N(_.fechas,b);N(n,b)},C=(n,b)=>{O.value=b},$=n=>{let b=n.target;for(;b.getAttribute("data-draggable")!="true";)b=b.parentElement;if(b.style.zIndex=-1,!O.value)return null;const g=document.elementFromPoint(n.clientX,n.clientY);if(!g)return null;const m=JSON.parse(JSON.stringify(O.value));m.fecha=g.getAttribute("data-dia"),m.hora=g.getAttribute("data-hora"),m.app_empleado_id=g.getAttribute("data-empleado"),m.start=`${m.fecha} ${m.hora}`,m.tipo="peluqueria",O.value=null,b.style.zIndex=100,P.emit("edit_cita",m)},N=(n,b)=>{n.forEach(g=>{const m=D(`${b} ${g.entrada}`,"YYYY-MM-DD HH:mm"),R=D(`${b} ${g.salida}`,"YYYY-MM-DD HH:mm").diff(m,"minutes");al.range(R/30).forEach((J,L)=>{const G=m.clone().add(L*30,"minutes").format("YYYY-MM-DD_HH:mm"),ee=`${_.empleado.nombre}_${G}`;u.value[ee]||(u.value[ee]=[]),u.value[ee].push(ee)})})},l=n=>u.value[n],B=(n=null)=>{if(n&&n.id)return P.emit("open_form",n);P.emit("open_form",{app_empleado_id:_.empleado.id,fecha:_.dia_actual,intervalo:n})},X=n=>{const b=`${n.start.substring(0,10)}_${n.start.substring(11)}`,g=`${_.empleado.nombre}_${b}`;return y.value[g]?{display:"block",top:`${y.value[g].offsetTop}px`,height:`${n.duracion/30*_.interval_height}px`,backgroundColor:n.color,position:"absolute",width:"auth"}:{display:"none"}};return W(O,n=>{},{deep:!0}),W(()=>_.citas,n=>{Be(()=>{p.value=n})},{immediate:!0}),W(()=>_.horario,n=>{n&&w(n,_.dia_actual)},{immediate:!0}),W(()=>_.dia_actual,n=>{_.horario&&w(_.horario,n)}),(n,b)=>(v(),H("div",null,[S("div",{class:ye([[f.type=="week"?"week":"day",{"hide-column":!f.horario}],"empleado-column"])},[S("div",dl,[e(Re,{color:f.empleado.color,to:{path:`/guardar-empleado-app?id=${f.empleado.id}`},small:"",class:"white--text"},{default:a(()=>[V(E(f.empleado.nombre)+" - "+E(f.empleado.id),1)]),_:1},8,["color","to"])]),(v(!0),H(z,null,ie(f.intervalos,(g,m)=>(v(),H(z,null,[f.horario&&l(`${f.empleado.nombre}_${f.dia_actual}_${g}`)?(v(),H("div",{key:0,onClick:Y=>B(g),class:"empleado-row",style:Ae({height:f.interval_height+"px"}),ref_for:!0,ref:Y=>y.value[`${f.empleado.nombre}_${f.dia_actual}_${g}`]=Y,"data-dia":f.dia_actual,"data-empleado":f.empleado.id,"data-hora":g,onDragover:b[0]||(b[0]=De(()=>{},["prevent"])),onDragenter:b[1]||(b[1]=De(()=>{},["prevent"]))},E(g),45,cl)):(v(),H("div",{key:1,style:Ae({height:f.interval_height+"px"}),class:"empleado-row disabled-row"},E(g),5))],64))),256)),(v(!0),H(z,null,ie(p.value,g=>(v(),H("div",{class:"cita-element",onClick:m=>B(g),ref_for:!0,ref:m=>h.value[`${f.empleado.nombre}_${f.dia_actual}`]=m,style:Ae([X(g)]),onDragstart:m=>C(m,g),onDragend:b[2]||(b[2]=m=>$(m)),"data-draggable":"true",draggable:"true"},[g.confirmada?j("",!0):(v(),q(qe,{key:0,small:""},{default:a(()=>b[3]||(b[3]=[V("ri-error-warning-fill")])),_:1})),S("i",pl,E(g.usuario)+" - "+E(g.telefono),1)],44,ml))),256))],2)]))}},vl={class:"d-flex align-center"},_l={class:"text-center pb-6"},gl={class:"text-h4 mb-2"},bl={class:"text-body-1"},yl={__name:"CRUDSelect",props:{modelValue:{type:Number,required:!0,default:null},title:{type:String,required:!0},items:{type:Array,required:!0},itemTitle:{type:String,required:!0},itemValue:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String},rules:{type:Array},clearable:{type:Boolean,default:!1},density:{type:String}},emits:["update:modelValue","update:selectedItem","submit","delete"],setup(f,{emit:_}){const p=f,u=_,h=s(null),y=s({id:null,nombre:"",apellidos:"",telefono:"",email:"",observaciones:""}),O=s({}),w=s(!0),C=s(!1),$=s(!1),N=m=>{u("update:modelValue",m)},l=()=>{var m;(m=w.value)==null||m.validate().then(({valid:Y})=>{Y&&(console.log("selectedItem.value",y.value),u("update:selectedItem",y.value),u("submit",y.value),C.value=!1,Be(()=>{var R,Z;(R=w.value)==null||R.reset(),(Z=w.value)==null||Z.resetValidation()}))})},B=m=>{m!=null?y.value=m:(h.value=null,g()),u("update:selectedItem",y.value),C.value=!0},X=()=>{C.value=!1},n=m=>{m!=null&&(y.value=m),$.value=!0},b=()=>{u("delete",y.value.id),h.value=null,g(),$.value=!1},g=()=>{y.value={id:null,nombre:"",apellidos:"",telefono:"",email:"",observaciones:""}};return W(()=>{p.modelValue!=null&&(h.value=p.modelValue)}),W(h,m=>{m!=null&&(y.value=p.items.find(Y=>Y.id===m))}),(m,Y)=>{const R=Ge,Z=rl;return v(),H(z,null,[S("div",vl,[e(Ye,{modelValue:k(h),"onUpdate:modelValue":[Y[0]||(Y[0]=J=>he(h)?h.value=J:null),N],density:f.density,items:p.items,"item-title":p.itemTitle,"item-value":p.itemValue,label:p.label,placeholder:p.placeholder,rules:p.rules,clearable:p.clearable},{item:a(({props:J,item:L})=>[e(nl,We(Xe(J)),{append:a(()=>[e(x,{icon:"ri-edit-box-line",variant:"text",size:"small",onClick:G=>B(L.raw)},null,8,["onClick"]),e(x,{icon:"ri-delete-bin-7-line",variant:"text",color:"error",size:"small",onClick:G=>n(L.raw)},null,8,["onClick"])]),default:a(()=>[e(il,null,{default:a(()=>[V(E(L.raw[J.itemTitle]),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","density","items","item-title","item-value","label","placeholder","rules","clearable"]),e(x,{icon:"ri-add-line",size:"small",class:"ml-2",onClick:Y[1]||(Y[1]=J=>B(null))})]),e(Ce,{modelValue:k(C),"onUpdate:modelValue":Y[3]||(Y[3]=J=>he(C)?C.value=J:null),width:"500"},{default:a(()=>[e(se,null,{default:a(()=>[e(R,{variant:"text",size:"default",onClick:X}),e(Ve,null,{default:a(()=>[S("div",_l,[S("h4",gl,E(k(h)==null?`Nuevo ${p.title}`:`Editar ${p.title}`),1),S("div",bl," Ingrese los datos del "+E(p.title),1)])]),_:1}),e(ae,null,{default:a(()=>[e(Ke,{ref_key:"refForm",ref:w,modelValue:k(O),"onUpdate:modelValue":Y[2]||(Y[2]=J=>he(O)?O.value=J:null),onSubmit:De(l,["prevent"])},{default:a(()=>[e(ne,null,{default:a(()=>[Ze(m.$slots,"form"),e(M,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[e(x,{type:"submit",color:"primary"},{default:a(()=>Y[4]||(Y[4]=[V(" Confirmar ")])),_:1}),e(x,{type:"button",color:"secondary",variant:"outlined",onClick:X},{default:a(()=>Y[5]||(Y[5]=[V(" Cancelar ")])),_:1})]),_:1})]),_:3})]),_:3},8,["modelValue"])]),_:3})]),_:3})]),_:3},8,["modelValue"]),e(Z,{isDialogVisible:k($),confirmationQuestion:`¿Estás seguro de eliminar ${p.title}?`,confirmTitle:`Eliminar ${p.title}`,onConfirm:b},null,8,["isDialogVisible","confirmationQuestion","confirmTitle"])],64)}}},hl={__name:"deleteEventDialog",setup(f){const _=ke(),p=s(!1),u=[{id:1,label:"No asiste"},{id:2,label:"Cancela cliente"},{id:3,label:"Erronea"}],h=s(null),y=s(null),O=C=>{h.value=C};P.on("open_delete_dialog",C=>{p.value=!0,y.value=C});const w=async()=>{try{const C=await de(`/eliminarcita/${y.value}/${h.value}`,{method:"GET"});_.success("Cita eliminada"),p.value=!1,P.emit("close_appoiment_dialog")}catch(C){console.log(C)}};return(C,$)=>(v(),q(Ce,{modelValue:p.value,"onUpdate:modelValue":$[1]||($[1]=N=>p.value=N),width:"500"},{default:a(()=>[e(se,null,{default:a(()=>[e(ae,{class:"pt-4"},{default:a(()=>[$[2]||($[2]=S("h3",{class:"text-center"}," Para eliminar la cita debe indicar un motivo ",-1)),e(M,{"justify-center":"",cols:"12",class:"d-flex py-6 justify-center"},{default:a(()=>[(v(),H(z,null,ie(u,N=>e(x,{onClick:l=>O(N.id),color:h.value==N.id?"success":"grey darken-2",class:"mx-2",small:""},{default:a(()=>[V(E(N.label),1)]),_:2},1032,["onClick","color"])),64))]),_:1})]),_:1}),e(ll,null,{default:a(()=>[e(ne,{align:"center",justify:"center"},{default:a(()=>[h.value?(v(),q(x,{key:0,onClick:w,small:"",md:"3",rounded:"",depressed:"",color:"danger",class:"white--text red mt-0 ml-4 mb-4"},{default:a(()=>$[3]||($[3]=[V("Eliminar")])),_:1})):j("",!0),e(x,{onClick:$[0]||($[0]=N=>p.value=!1),small:"",md:"3",rounded:"",depressed:"",color:"success",class:"white--text mt-0 mx-2 mb-4"},{default:a(()=>$[4]||($[4]=[V("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Vl={style:{"font-size":"12px !important","margin-top":"10px !important","margin-bottom":"10px !important"}},Dl={__name:"AppointmentDialog",props:{isDialogOpen:{type:Boolean,default:!1},app_tienda_id:{type:Number,default:null},item:{type:Object,default:()=>({})},empleados:{type:Array,default:()=>[]},servicios:{type:Array,default:()=>[]},clientes:{type:Array,default:()=>[]},user:{type:Object,default:()=>({id:null,nombre:"",apellidos:"",email:"",telefono:"",codigo:"",observaciones:"",avatar:null,password:null,direccion:[]})}},emits:["generar_factura","save","updatecitas","refresh","submit","update:isDialogOpen"],setup(f,{emit:_}){const p=ke(),u=f,h=_,y=s(u.isDialogOpen),O=s(null),w=s(!1),C=s(!1),$=s("");s(!1);const N=s(!1),l=s({id:null,app_empleado_id:null,fecha:null}),B=s({}),X=s({historial:[],usuario:{observaciones:""}}),n=s({id:null,nombre:"",apellidos:"",telefono:"",email:"",observaciones:""}),b=s([]),g=s([]);s("nuevo");const m=s(null),Y=s(!1);re(()=>[]);const R=s(!1),Z=(i,t)=>{let I=[];return R.value==!0?i.forEach((U,le,c)=>{let ue=D(`2021-03-26 ${U}`,"YYYY-MM-DD HH:mm"),F=[-60,-30,0,...Q._.range(t/30+2).map(oe=>(oe+1)*30)].map(oe=>ue.clone().add(oe,"minutes").format("HH:mm")),pe=c.includes(F[0])&&c.includes(F[1]),r=!c.includes(F[1]),o=c.includes(F[F.length-2])&&c.includes(F[F.length-3]),d=!c.includes(F[F.length-3]),T=Q._.drop(F,2),A=Q._.dropRight(T,3),K=Q._.difference(A,c).length===0;(pe||r)&&(o||d)&&K&&I.push(U)}):i.forEach((U,le,c)=>{let ue=D(`2021-03-26 ${U}`,"YYYY-MM-DD HH:mm"),F=[-60,-30,0,...Q._.range(t/30+2).map(d=>(d+1)*30)].map(d=>ue.clone().add(d,"minutes").format("HH:mm")),pe=Q._.drop(F,2),r=Q._.dropRight(pe,3);Q._.difference(r,c).length===0&&I.push(U)}),I},J=i=>{g.value=i.map(t=>({app_empleado_id:t.app_empleado_id,nombre_empleado:t.nombre_empleado,horario:Z(t.diferencia,l.value.duracion)}))},L=i=>($.value=i,C.value=!0,null),G=async()=>{if(l.value.servicios.length==0&&l.value.fecha==null&&l.value.app_empleado_id==null)return L("Asigne un empleado, dia y servicios para consultar las citas disponibles");if(l.value.servicios.length==0&&l.value.fecha==null)return L("Asigne un dia en el calendario y servicios para consultar las citas disponibles");if(l.value.servicios.length==0)return L("Asigne servicios para consultar las citas disponibles");if(l.value.app_empleado_id==null)return L("Asigne un empleado para consultar las citas disponibles");l.value.fecha==null&&(l.value.fecha=D().format("YYYY-MM-DD"));let i={id:l.value.id,fecha:l.value.fecha,tienda_id:u.app_tienda_id,tipo:"peluqueria",empleado_id:l.value.app_empleado_id};l.value.precio=0,l.value.precio=l.value.servicios.reduce((I,U)=>I+U.precio,0),l.value.duracion=l.value.servicios.reduce((I,U)=>I+U.duracion,0);const t=await $e("/app/buscar-horario-disponible",{method:"POST",body:i});l.value.id||(l.value.start=l.value.fecha,l.value.end=null),m.value=J(t)},ee=(i,t)=>{let I="";return l.value.start!=null&&(I=l.value.start.substring(11,16)),i==I&&l.value.app_empleado_id==t?(Y.value=!0,"success"):"secondary"},Me=i=>`${i.nombre} ${i.apellidos}`,ce=i=>{y.value=i,h("update:isDialogOpen",i)};re(()=>X.value.historial.length>0?X.value.historial.map(i=>i.servicio):null);const Se=()=>{y.value=!1,h("update:isDialogOpen",!1)},we=()=>{console.log("saveEvent")},Ee=(i,t)=>{Y.value=!1,N.value=!0,l.value.tipo="peluqueria",l.value.start=`${l.value.fecha} ${i}`,l.value.end=D(l.value.start).clone().add(l.value.duracion,"minutes").format("YYYY-MM-DD HH:mm")},xe=()=>h("save",l.value),_e=()=>{g.value=[],l.value={id:null,app_empleado_id:null,app_usuario_id:null,app_tienda_id:null,app_mascota_id:null,tipo_id:1,color:null,start:null,end:null,duracion:null,servicios:[],fecha:null,observacionesMascota:"",observacionesUsuario:"",confirmada:1,recogida:0,direccion_recogida:null,direccion_entrega:null,pago:0,precio:0}},Oe=i=>n.value=i,Te=async i=>{try{const t=await de("/saveusuario",{method:"POST",body:n.value});h("refresh",t.data),h("update:isDrawerOpen",!1)}catch(t){t.status==422&&(errors.value=t.response._data.errors)}},He=async i=>{var t,I;if(i)try{const U=await $e(`/proveedores/${i}`,{method:"DELETE"});proveedores.value=proveedores.value.filter(le=>le.id!==i),factura.value.proveedor_id=null,resetProveedorSelected(),snackbarColor.value="success",snackbarText.value=U.message,snackbar.value=!0}catch(U){console.error(U),snackbarColor.value="error",snackbarText.value=((I=(t=U.response)==null?void 0:t._data)==null?void 0:I.message)??"Error al eliminar el proveedor",snackbar.value=!0}},ge=i=>{l.value=JSON.parse(JSON.stringify(i)),l.value.fecha=i.start.substring(0,10),l.value.tipo="peluqueria",l.value.tienda_id=u.app_tienda_id},be=async()=>{try{const i=await de(`/confirmar-cita/${l.value.id}`,{method:"GET"})}catch(i){console.log(i)}},Ne=()=>P.emit("open_delete_dialog",l.value.id),Ue=()=>h("generar_factura",l.value.id);return P.on("close_appoiment_dialog",()=>{y.value=!1,_e(),h("updatecitas")}),P.on("close_form",()=>{_e(),y.value=!1}),P.on("open_form",i=>{i.id?(ge(i),G()):(l.value.fecha=i.fecha,l.value.app_empleado_id=i.app_empleado_id,l.value.start=`${i.fecha} ${i.intervalo}`),y.value=!0}),W(()=>{u.isDialogOpen!=null&&(y.value=u.isDialogOpen),u.item!=null&&(l.value=JSON.parse(JSON.stringify(u.item))),u.user!=null&&(B.value=JSON.parse(JSON.stringify(u.user))),u.empleados!=null&&(b.value=JSON.parse(JSON.stringify(u.empleados)),b.value.unshift({id:null,nombre:"Selecciona un empleado"}))}),W(()=>l.value.servicios,i=>{i.length>0&&(l.value.end=D(l.value.start).clone().add(l.value.duracion,"minutes").format("YYYY-MM-DD HH:mm"))}),(i,t)=>{const I=Ge,U=yl,le=ol;return v(),H(z,null,[e(Ce,{modelValue:y.value,"onUpdate:modelValue":[t[13]||(t[13]=c=>y.value=c),ce],width:"900px",persistent:""},{default:a(()=>[e(se,null,{default:a(()=>[e(I,{variant:"text",size:"default",onClick:Se}),e(Ve,{class:"d-flex justify-center text-h4"},{default:a(()=>[V(E(l.value.id==null?"Agregar nueva":"Editar")+" cita ",1)]),_:1}),e(Ke,{ref_key:"formEvent",ref:O,modelValue:w.value,"onUpdate:modelValue":t[12]||(t[12]=c=>w.value=c),onSubmit:De(we,["prevent"])},{default:a(()=>[e(ae,{class:"mt-3"},{default:a(()=>[e(se,null,{default:a(()=>[e(Ve,null,{default:a(()=>t[14]||(t[14]=[V("Datos del cliente")])),_:1}),e(ae,null,{default:a(()=>[e(ne,{dense:""},{default:a(()=>[e(M,{cols:"12",md:"4"},{default:a(()=>[e(Ye,{label:"Empleado",modelValue:l.value.app_empleado_id,"onUpdate:modelValue":[t[0]||(t[0]=c=>l.value.app_empleado_id=c),G],items:b.value,"item-title":"nombre","item-value":"id"},null,8,["modelValue","items"])]),_:1}),e(M,null,{default:a(()=>[e(U,{title:"Cliente",modelValue:l.value.app_usuario_id,"onUpdate:modelValue":t[6]||(t[6]=c=>l.value.app_usuario_id=c),items:u.clientes,"item-title":Me,"item-value":"id",placeholder:"Selecciona un cliente",clearable:"","onUpdate:selectedItem":Oe,onSubmit:Te,onDelete:He},{form:a(()=>[e(M,{cols:"12",md:"6"},{default:a(()=>[e(ve,{modelValue:n.value.nombre,"onUpdate:modelValue":t[1]||(t[1]=c=>n.value.nombre=c),label:"Nombre",placeholder:"John",rules:["requiredValidator"in i?i.requiredValidator:k(Ie)]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(ve,{modelValue:n.value.apellidos,"onUpdate:modelValue":t[2]||(t[2]=c=>n.value.apellidos=c),label:"Apellidos",placeholder:"Doe",rules:["requiredValidator"in i?i.requiredValidator:k(Ie)]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12"},{default:a(()=>[e(ve,{modelValue:n.value.telefono,"onUpdate:modelValue":t[3]||(t[3]=c=>n.value.telefono=c),label:"Teléfono",placeholder:"+1 9876543210",rules:[i.phoneValidator]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12"},{default:a(()=>[e(ve,{modelValue:n.value.email,"onUpdate:modelValue":t[4]||(t[4]=c=>n.value.email=c),label:"Email",placeholder:"johndoe@email.com",rules:["requiredValidator"in i?i.requiredValidator:k(Ie),"emailValidator"in i?i.emailValidator:k(tl)]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12"},{default:a(()=>[e(ze,{modelValue:n.value.observaciones,"onUpdate:modelValue":t[5]||(t[5]=c=>n.value.observaciones=c),label:"Observaciones",placeholder:"Observaciones"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","items"])]),_:1}),e(M,{cols:"12"},{default:a(()=>[e(ze,{outlined:"",height:"50px",modelValue:B.value.observaciones,"onUpdate:modelValue":t[7]||(t[7]=c=>B.value.observaciones=c),label:"Observaciones del cliente"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,null,{default:a(()=>[e(se,null,{default:a(()=>[e(Ve,null,{default:a(()=>t[15]||(t[15]=[V("Datos del Servicios")])),_:1}),e(ae,null,{default:a(()=>[e(ne,null,{default:a(()=>[e(M,{cols:"12",md:"10"},{default:a(()=>[e(Ye,{label:"Servicios",modelValue:l.value.servicios,"onUpdate:modelValue":[t[8]||(t[8]=c=>l.value.servicios=c),G],items:u.servicios,"item-title":"nombre","return-object":"",multiple:"",chips:""},null,8,["modelValue","items"])]),_:1}),e(M,{cols:"12",md:"2"},{default:a(()=>[e(ve,{modelValue:l.value.precio,"onUpdate:modelValue":t[9]||(t[9]=c=>l.value.precio=c),label:"Precio",rules:[i.numberValidator]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,null,{default:a(()=>[e(ne,null,{default:a(()=>[e(M,{cols:"12",md:"5",class:"d-flex",style:{"margin-top":"10px"}},{default:a(()=>[l.value.id?(v(),q(x,{key:0,rounded:"",depressed:"",onClick:Ne,class:"mr-2"},{default:a(()=>t[16]||(t[16]=[V("eliminar")])),_:1})):j("",!0),l.value.id?(v(),q(x,{key:1,rounded:"",onClick:be,outlined:"",color:l.value.confirmada?"grey":"success",class:"mr-2"},{default:a(()=>[V(E(l.value.confirmada?"Desconfirmar":"Confirmar"),1)]),_:1},8,["color"])):j("",!0),l.value.id?(v(),q(x,{key:2,class:"white--text mr-2",rounded:"",onClick:Ue,outlined:"",color:"green"},{default:a(()=>t[17]||(t[17]=[V("Generar Factura")])),_:1})):j("",!0)]),_:1})]),_:1}),e(ne,null,{default:a(()=>[e(M,{cols:"12",md:"6",class:"my-1 py-1"},{default:a(()=>[e(le,{modelValue:l.value.fecha,"onUpdate:modelValue":[t[10]||(t[10]=c=>l.value.fecha=c),G],label:"Fecha",placeholder:"Selecciona una fecha",config:{inline:!0}},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"5",class:"pt-0"},{default:a(()=>[S("div",Vl,[t[18]||(t[18]=S("strong",null,"INICIO: ",-1)),N.value||l.value.id?(v(),H(z,{key:0},[V(E(l.value.start),1)],64)):j("",!0),t[19]||(t[19]=S("br",null,null,-1)),t[20]||(t[20]=S("strong",null,"FIN: ",-1)),N.value||l.value.id?(v(),H(z,{key:1},[V(E(l.value.end),1)],64)):j("",!0),t[21]||(t[21]=S("br",null,null,-1)),t[22]||(t[22]=S("strong",null,"DURACIÓN: ",-1)),V(E(l.value.duracion),1)]),(v(!0),H(z,null,ie(g.value,(c,ue)=>(v(),q(ne,{dense:"",key:c.app_empleado_id},{default:a(()=>[e(M,{cols:"12"},{default:a(()=>[c.horario.length>0?(v(),q(Re,{key:0,"prepend-icon":"ri-account-circle-line",color:"success",variant:"outlined"},{default:a(()=>[V(E(c.nombre_empleado),1)]),_:2},1024)):j("",!0)]),_:2},1024),(v(!0),H(z,null,ie(c.horario,(te,me)=>(v(),q(M,{key:me,cols:"12",md:"3"},{default:a(()=>[e(x,{elevation:"2",onClick:F=>Ee(te,c.app_empleado_id),rounded:"",small:"",block:"",color:ee(te,c.app_empleado_id)},{default:a(()=>[V(E(te),1)]),_:2},1032,["onClick","color"])]),_:2},1024))),128))]),_:2},1024))),128)),e(x,{disabled:k(p).loader,class:"mt-3",onClick:t[11]||(t[11]=c=>xe()),block:"",rounded:""},{default:a(()=>[V(E(l.value.id==null?"Guardar":"Editar")+" cita ",1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(hl)],64)}}},$l={class:"dia-header"},Yl={class:"cita-container mt-2"},sa={__name:"index",emits:["open_dialog","abrirbusqueda"],setup(f,{emit:_}){const p=ke(),{tienda:u,tiendas:h,empleados:y,clientes:O,servicios:w,getTiendas:C,getData:$}=ul(),N=s(null),l=s("week"),B=["week","day"];s(0);const X=s(26),n=s(D().format("YYYY-MM-DD").substring(0,10)),b=D().format("YYYY-MM-DD").substring(0,10),g=s("08:00"),m=s("21:30"),Y=s([]),R=s([]);s("");const Z=s(!1),J=s(!1),L=s(!1);s(null),re(()=>D(n).format("MMMM"));const G=s({id:null,app_empleado_id:null,app_usuario_id:null,app_tienda_id:u.value,app_mascota_id:null,tipo_id:1,color:null,start:null,end:null,duracion:null,servicios:[],fecha:null,observacionesMascota:"",observacionesUsuario:"",confirmada:1,recogida:0,direccion_recogida:null,direccion_entrega:null,pago:0,precio:""}),ee=re(()=>{let r=y.value.flatMap(d=>d.horario);const o={};return r.forEach(d=>{let T=`${d.app_empleado_id}_${d.dia}`;(o[T]=o[T]||[]).push(d)}),o}),Me=re(()=>{let r=y.value.flatMap(d=>d.fecha);const o={};return r.forEach(d=>{let T=`${d.app_empleado_id}_${d.fecha}`;(o[T]=o[T]||[]).push(d)}),o}),ce=re(()=>{var o=D(n.value).clone().startOf("isoweek");return Q._.range(7).map(T=>{let A=D(o).add(T,"days");return{numero_dia:A.format("DD"),nombre_dia:A.format("dddd"),full_date:A.format("YYYY-MM-DD")}})}),Se=re(()=>{if(l.value=="day"){let r=ce.value.findIndex(o=>o.full_date==n.value);return[ce.value[r]]}else return ce.value}),we=()=>n.value=D().format("YYYY-MM-DD").substring(0,10),Ee=r=>({Monday:"Lunes",Tuesday:"Martes",Wednesday:"Miercoles",Thursday:"Jueves",Friday:"Viernes",Saturday:"Sabado",Sunday:"Domingo"})[r],xe=()=>{let r=D(n.value).weekday()==1?2:1,o=l.value=="week"?7:r;n.value=D(n.value).subtract(o,"days").format("YYYY-MM-DD")},_e=()=>{let r=D(n.value).weekday()==6?2:1,o=l.value=="week"?7:r;n.value=D(n.value).add(o,"days").format("YYYY-MM-DD")};el(()=>{Z.value=!1,ue(),C(),N.value="peluqueria"});const Oe=()=>le(n.value),Te=r=>{let o=O.value.findIndex(d=>d.id==r.id);o>-1?O.value[o]=r:O.value.unshift(r)},He=r=>l.value=r,ge=s(null),be=s(null),Ne=r=>{ge.value.scrollLeft=r.target.scrollLeft},Ue=r=>{be.value.scrollLeft=r.target.scrollLeft},i=(r,o)=>c.value[`${r.nombre}_${o}`],t=(r,o)=>{let d,T=D(`${o}`,"YYYY-MM-DD");if(D("2021-11-15","YYYY-MM-DD"),r.fecha.length==0)d=ee.value[`${r.id}_${D(o).weekday()}`];else{let A=[],K=[],oe=[],Fe=!1,Je=!1,Le=!1;d=void 0,r.fecha.forEach(fe=>{let je=D(`${fe.fecha}`,"YYYY-MM-DD");u==fe.app_tienda_id?JSON.stringify(je)==JSON.stringify(T)?(K==null&&(K=[]),K.push({app_empleado_id:r.id,app_tienda_id:fe.app_tienda_id,dia:D(o).weekday(),entrada:fe.entrada,salida:fe.salida}),Fe=!0):(Je=!0,A=ee[`${r.id}_${D(o).weekday()}`]):JSON.stringify(je)==JSON.stringify(T)&&(oe=void 0,Le=!0)}),Fe?d=K:Le?d=oe:Je&&(d=A)}return r.vacaciones.length>0&&r.vacaciones.forEach(A=>{let K=D(`${A.fecha}`,"YYYY-MM-DD HH:mm"),oe=D(`${o}`,"YYYY-MM-DD HH:mm");JSON.stringify(K)==JSON.stringify(oe)&&(d=void 0)}),d},I=(r,o)=>Me.value[`${r.id}_${o}`],U=r=>{r.value=r,n.value=r.full_date,l.value="day"},le=async r=>{try{const o=await de(`/geteventsbymonth/${r}`,{method:"GET"});R.value=o}catch{}},c=re(()=>{const r={};return R.value.forEach(o=>{let d=o.start.substring(0,10),T=`${o.empleado}_${d}`;(r[T]=r[T]||[]).push(o)}),r}),ue=()=>{let r=D(`2021-03-26 ${g.value}`,"YYYY-MM-DD HH:mm"),d=D(`2021-03-26 ${m.value}`,"YYYY-MM-DD HH:mm").diff(r,"minutes"),T=Q._.range(d/30);Y.value=T.map((A,K)=>r.clone().add(K*30,"minutes").format("HH:mm"))};P.on("edit_cita",r=>{te(r)});const te=async r=>{try{const o=await de("/savecita",{method:"POST",body:r});P.emit("close_form"),p.success("Cita actualizada con exito"),le(n.value)}catch(o){console.log(o)}},me=()=>J.value=!0,F=()=>{P.emit("open_form",{fecha:n.value})},pe=async r=>{try{const o=await $e(`generate-factura/${r}`);p.success("Factura generada con exito")}catch{p.error("Error generando factura")}};return W(n,(r,o)=>{le(r)},{immediate:!0}),W(u,(r,o)=>{u.value=parseInt(u.value),G.value.app_tienda_id=u.value,r&&$(N.value,r)},{immediate:!0}),(r,o)=>(v(),H("section",null,[e(se,null,{default:a(()=>[e(ae,null,{default:a(()=>[k(p).loader?(v(),q(Pe,{key:0,class:"mb-4",indeterminate:"",color:"primary"})):j("",!0),e(ne,null,{default:a(()=>[e(M,{cols:"12",md:"3"},{default:a(()=>[e(Ye,{items:k(h),modelValue:k(u),"onUpdate:modelValue":o[0]||(o[0]=d=>he(u)?u.value=d:null),"item-title":"nombre","item-value":"id",variant:"outlined","hide-details":"",label:"Tienda"},null,8,["items","modelValue"]),o[4]||(o[4]=S("br",null,null,-1)),e(x,{onClick:F},{default:a(()=>o[2]||(o[2]=[V("Nuevo")])),_:1}),k(u)?(v(),q(x,{key:0,onClick:me,variant:"outlined",class:"ml-2"},{default:a(()=>o[3]||(o[3]=[V("Buscar cita")])),_:1})):j("",!0)]),_:1}),k(u)?(v(),q(M,{key:0,cols:"12",md:"8"},{default:a(()=>[(v(),H(z,null,ie(B,d=>e(x,{rounded:"",depressed:"",class:"mr-2",color:d==l.value?"success":"",key:d,onClick:T=>He(d)},{default:a(()=>[V(E(d),1)]),_:2},1032,["color","onClick"])),64)),e(x,{outlined:"",class:"ml-4",color:"grey darken-2",onClick:we},{default:a(()=>o[5]||(o[5]=[V(" Hoy ")])),_:1}),e(x,{fab:"",text:"",class:"ml-2",small:"",color:"grey darken-2",onClick:xe},{default:a(()=>[e(qe,{small:""},{default:a(()=>o[6]||(o[6]=[V("ri-arrow-left-s-line")])),_:1})]),_:1}),e(x,{fab:"",text:"",class:"ml-2",small:"",color:"grey darken-2",onClick:_e},{default:a(()=>[e(qe,{small:""},{default:a(()=>o[7]||(o[7]=[V("ri-arrow-drop-right-line")])),_:1})]),_:1})]),_:1})):j("",!0),k(u)?(v(),q(M,{key:1,cols:"12"},{default:a(()=>[S("div",{ref_key:"false_scroll",ref:ge,class:"false_scroll",onScroll:Ue},o[8]||(o[8]=[S("div",{class:"false_scroll_container"},null,-1)]),544)]),_:1})):j("",!0),k(u)?(v(),q(M,{key:2,cols:"12"},{default:a(()=>[S("div",{ref_key:"calendar_wrap",ref:be,onScroll:Ne,class:"calendar-wrapper"},[S("div",{class:ye(["dia-container",{"full-width":l.value=="day"}])},[(v(!0),H(z,null,ie(Se.value,(d,T)=>(v(),H("div",{class:ye(["dia-component",{"full-width":l.value=="day"}])},[S("div",$l,[S("span",null,E(Ee(d.nombre_dia)),1),e(x,{id:"diabtn",onClick:A=>U(d),class:ye({"green white--text":d.full_date==k(b)})},{default:a(()=>[V(E(d.numero_dia),1)]),_:2},1032,["onClick","class"])]),S("div",Yl,[(v(!0),H(z,null,ie(k(y),(A,K)=>(v(),q(fl,{intervalos:Y.value,key:A.id,app_tienda_id:k(u),empleado:A,citas:i(A,d.full_date),horario:t(A,d.full_date),fechas:I(A,d.full_date),dia_actual:d.full_date,interval_height:X.value,type:l.value},null,8,["intervalos","app_tienda_id","empleado","citas","horario","fechas","dia_actual","interval_height","type"]))),128))])],2))),256))],2)],544)]),_:1})):j("",!0),e(M,{cols:"12",md:"3"})]),_:1})]),_:1})]),_:1}),e(Dl,{isDialogOpen:L.value,"onUpdate:isDialogOpen":o[1]||(o[1]=d=>L.value=d),item:G.value,app_tienda_id:k(u),empleados:k(y),servicios:k(w),clientes:k(O),user:r.usuario,onSave:te,onUpdatecitas:Oe,onGenerar_factura:pe,onRefresh:Te},null,8,["isDialogOpen","item","app_tienda_id","empleados","servicios","clientes","user"]),e(sl)]))}};export{sa as default};
