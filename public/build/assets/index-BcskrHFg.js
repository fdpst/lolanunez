import{p as Q}from"./paginationMeta-BbY5dJ0C.js";import{aT as E,r as u,w as $,o as F,f as K,e as o,b as a,n as e,ag as D,am as L,af as B,v as C,ak as W,I as X,c as Y,d as h,x as M,a0 as q,a as Z}from"./main-BwDGDDDW.js";import{r as _,e as ee}from"./validators-CrSGMxiT.js";import{_ as ae}from"./AppDrawerHeaderSection-Dm2jDqJm.js";import{P as le}from"./vue3-perfect-scrollbar.esm-BA1GFVP8.js";import{$ as I,a as te}from"./api-CjWrXaZL.js";import{V as j}from"./VDivider-PVfbuN4-.js";import{V as J}from"./VCard-Cpw0jw9u.js";import{V as z}from"./VCardText-BKkdmkn-.js";import{V as re}from"./VForm-DbaU_ACV.js";import{V as oe,a as P}from"./VRow-DJH2tZVu.js";import{V as T}from"./VTextField-DqZOZREA.js";import{V as G}from"./VSelect-Cdsnm3mB.js";import{V as se}from"./VNavigationDrawer-DiCpI_FT.js";import{_ as ie}from"./DeleteDialog-ClSHg4_M.js";import{V as ne}from"./VDataTableServer-BLeqennM.js";import"./helpers-DK5QwNv0.js";import"./VSpacer-xWNtBUsj.js";/* empty css              */import"./VAvatar-DYn3is-W.js";import"./VImg-BYy41-F9.js";import"./index-D8byVCHt.js";import"./index-9rIf2CJL.js";import"./form-BEvPHhJ7.js";/* empty css                   */import"./VCounter-IA5S7b1U.js";import"./VField-5sqsN37e.js";import"./VInput-CVFVwJKu.js";import"./VList-CLtMWoGj.js";import"./ssrBoot-B7QpyNAy.js";import"./dialog-transition-GiYjLY5n.js";import"./VMenu-BWP2lKbi.js";import"./VCheckboxBtn-CuvLREeJ.js";import"./VSelectionControl-D0_t5DTC.js";import"./VChip-CXCzEWTC.js";import"./DialogCloseBtn-B0aYGOTk.js";import"./VDialog-5yhkawgU.js";import"./VDataTable-B4BcEe_U.js";import"./VPagination-DIhj3juL.js";import"./VTable-CK8MMDdB.js";import"./filter-B9tzeaPh.js";const ue={__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},user:{type:Object,default:()=>null}},emits:["update:isDrawerOpen","userData"],setup(A,{emit:y}){const d=A,s=E(),b=y;u(!1),u(!1);const f=u({}),m=u({id:null,name:null,email:null,role:null}),S=u([{id:1,label:"Administrador"},{id:2,label:"Usuario"},{id:3,label:"Turno"}]),k=u(!1),p=u();u();const c=()=>{f.value={},b("update:isDrawerOpen",!1)},v=async()=>{try{f.value={};const r=await I("/api/save-user",{method:"POST",body:m.value});s.success("Usuario guardado con éxito"),b("userData",r),b("update:isDrawerOpen",!1)}catch(r){s.error("Algo ha salido mal"),r.status==422&&(f.value=r.response._data.errors)}},w=async()=>{var x;const{valid:r,errors:i}=await((x=p.value)==null?void 0:x.validate());r&&await v()},U=()=>{W(()=>{var r,i;(r=p.value)==null||r.reset(),(i=p.value)==null||i.resetValidation()}),m.value={id:null,name:null,email:null,role:null}};$(()=>{d.user!=null?m.value=JSON.parse(JSON.stringify(d.user)):U()});const O=r=>{b("update:isDrawerOpen",r)};return(r,i)=>{const x=ae;return F(),K(se,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":d.isDrawerOpen,"onUpdate:modelValue":O},{default:o(()=>[a(x,{title:d.user!=null?"Editar Usuario":"Agregar Usuario",onCancel:c},null,8,["title"]),a(j),a(e(le),{options:{wheelPropagation:!1}},{default:o(()=>[a(J,{flat:""},{default:o(()=>[a(z,null,{default:o(()=>[a(re,{ref_key:"refForm",ref:p,modelValue:e(k),"onUpdate:modelValue":i[3]||(i[3]=V=>D(k)?k.value=V:null),onSubmit:L(w,["prevent"])},{default:o(()=>[a(oe,null,{default:o(()=>[a(P,{cols:"12"},{default:o(()=>[a(T,{modelValue:e(m).name,"onUpdate:modelValue":i[0]||(i[0]=V=>e(m).name=V),rules:["requiredValidator"in r?r.requiredValidator:e(_)],label:"Nombre",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),a(P,{cols:"12"},{default:o(()=>[a(T,{modelValue:e(m).email,"onUpdate:modelValue":i[1]||(i[1]=V=>e(m).email=V),rules:["requiredValidator"in r?r.requiredValidator:e(_),"emailValidator"in r?r.emailValidator:e(ee)],label:"Email",placeholder:"johndoe@email.com","error-messages":e(f).email?e(f).email[0]:""},null,8,["modelValue","rules","error-messages"])]),_:1}),a(P,{cols:"12"},{default:o(()=>[a(G,{modelValue:e(m).role,"onUpdate:modelValue":i[2]||(i[2]=V=>e(m).role=V),label:"Perfil",placeholder:"Selecciona una perfil",rules:["requiredValidator"in r?r.requiredValidator:e(_)],items:e(S),"item-value":"id","item-title":"label"},null,8,["modelValue","rules","items"])]),_:1}),a(P,{cols:"12"},{default:o(()=>[a(B,{type:"submit",class:"me-4"},{default:o(()=>i[4]||(i[4]=[C(" Aceptar ")])),_:1}),a(B,{type:"reset",variant:"outlined",color:"error",onClick:c},{default:o(()=>i[5]||(i[5]=[C(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},de={class:"app-user-search-filter d-flex align-center"},me={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},pe={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},fe={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},ce={class:"d-flex gap-x-2 align-center me-2"},la={__name:"index",setup(A){E();const y=u(""),d=u(10),s=u(1),b=u(),f=u(),m=t=>{var l,g;s.value=t.page,b.value=(l=t.sortBy[0])==null?void 0:l.key,f.value=(g=t.sortBy[0])==null?void 0:g.order},S=[{title:"Usuario",key:"name"},{title:"Email",key:"email"},{title:"Perfil",key:"role"},{title:"Actions",key:"actions",sortable:!1}],k={1:"administrador",2:"usuario",3:"turno"},p=u(!1),c=u(null),v=u([]),w=u(0),U=u(!1),O=async()=>{try{const t=await te("/getusuarios",{method:"GET",params:{search:y.value,itemsPerPage:d.value,page:s.value,sortBy:b.value,orderBy:f.value}});console.log(t),v.value=t.data,w.value=t.total}catch(t){console.error(t)}},r=t=>{let l=v.value.findIndex(g=>g.id==t.id);if(l>-1)return v.value[l]=t;v.value.unshift(t)},i=async t=>{await I(`/api/delete-user/${t}`,{method:"GET"});let l=v.value.findIndex(g=>g.id==t);l>-1&&v.value.splice(l,1)},x=()=>{p.value=!0,c.value=null},V=t=>{p.value=!0,c.value=t},R=t=>{c.value=t,U.value=!0};return X(O),$([d,b,f,s,y],()=>{O()}),$(p,async t=>{t||(c.value={})}),(t,l)=>{var N;const g=Z("IconBtn");return F(),Y("section",null,[a(J,{title:"Filtros",class:"mb-6"},{default:o(()=>[a(z,{class:"d-flex flex-wrap gap-4"},{default:o(()=>[h("div",de,[a(T,{modelValue:e(y),"onUpdate:modelValue":l[0]||(l[0]=n=>D(y)?y.value=n:null),placeholder:"Buscar",density:"compact",class:"me-4"},null,8,["modelValue"]),a(B,{onClick:x},{default:o(()=>l[8]||(l[8]=[C(" Agregar nuevo usuario ")])),_:1})])]),_:1}),a(ne,{"items-per-page":e(d),"onUpdate:itemsPerPage":l[4]||(l[4]=n=>D(d)?d.value=n:null),page:e(s),"onUpdate:page":l[5]||(l[5]=n=>D(s)?s.value=n:null),items:e(v),"item-value":"id","items-length":e(w),headers:S,class:"text-no-wrap rounded-0","onUpdate:options":m},{"item.role":o(({item:n})=>[C(M(k[n.role]),1)]),"item.actions":o(({item:n})=>[a(g,{size:"small",onClick:H=>R(n)},{default:o(()=>[a(q,{icon:"ri-delete-bin-7-line"})]),_:2},1032,["onClick"]),a(g,{size:"small",onClick:H=>V(n)},{default:o(()=>[a(q,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(j),h("div",me,[h("div",pe,[l[9]||(l[9]=C(" Filas por página: ")),a(G,{modelValue:e(d),"onUpdate:modelValue":l[1]||(l[1]=n=>D(d)?d.value=n:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),h("p",fe,M(("paginationMeta"in t?t.paginationMeta:e(Q))({page:e(s),itemsPerPage:e(d)},e(w))),1),h("div",ce,[a(B,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:e(s)<=1,onClick:l[2]||(l[2]=n=>e(s)<=1?s.value=1:s.value--)},null,8,["disabled"]),a(B,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:e(s)>=Math.ceil(e(w)/e(d)),onClick:l[3]||(l[3]=n=>e(s)>=Math.ceil(e(w)/e(d))?s.value=Math.ceil(e(w)/e(d)):s.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),a(ue,{isDrawerOpen:e(p),"onUpdate:isDrawerOpen":l[6]||(l[6]=n=>D(p)?p.value=n:null),user:e(c),onUserData:r},null,8,["isDrawerOpen","user"]),a(ie,{isDialogVisible:e(U),"onUpdate:isDialogVisible":l[7]||(l[7]=n=>D(U)?U.value=n:null),id:(N=e(c))==null?void 0:N.id,onSubmit:i},null,8,["isDialogVisible","id"])])}}};export{la as default};
