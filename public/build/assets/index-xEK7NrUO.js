import{aT as Ye,o as _,f as q,e as l,b as e,v as D,al as Be,n as $,r as u,aU as Xe,w as L,ak as Ge,c as U,d as x,x as A,F as P,i as re,K as Fe,am as $e,a0 as Je,z as j,y as he,aK as Ze,aL as ea,af as T,ag as Ve,A as aa,a6 as te,I as la}from"./main-DXTHM_Z4.js";import{V as de,b as De,d as ta}from"./VCard-BBjecQUS.js";import{V as ee}from"./VCardText-DGP4d7zZ.js";import{V as Se}from"./VDialog-BXZSKyZJ.js";import{$ as ke,a as ce}from"./api-CWHLgCqw.js";import{h as Y}from"./moment-C5S46NFB.js";import{_ as oa,l as Q}from"./lodash-B2oo_5C5.js";import{V as Re}from"./VChip-CoWdbaPm.js";import{r as qe,e as ra}from"./validators-CrSGMxiT.js";import{_ as ia}from"./AppDateTimePicker-Co0_bleo.js";import{_ as na}from"./ConfirmDialog-YGOpYHE8.js";import{_ as We}from"./DialogCloseBtn-vF1tbmc_.js";import{a as sa,b as ua}from"./VList-5epMYaPo.js";import{V as Ce}from"./VAutocomplete-BrZJDE2O.js";import{V as Ke}from"./VForm-B4Tyf17S.js";import{V as oe,a as M}from"./VRow-U9BCKMf6.js";import{e as da}from"./es-B-Pf7tX4.js";import{V as _e}from"./VTextField-BfMLnCIA.js";import{V as Pe}from"./VTextarea-h0LfIizP.js";import"./VAvatar-QubjHI1z.js";import"./VImg-DTTLi8N3.js";import"./dialog-transition-CqXIoDZd.js";import"./index-D1tqMycq.js";import"./index-9rIf2CJL.js";import"./helpers-DK5QwNv0.js";import"./VField-B2YWi8oL.js";import"./form-ijrz4ipO.js";import"./VInput-BZH6jw62.js";import"./ssrBoot-BzQpit4r.js";import"./VDivider-CVdsTcIK.js";import"./VSelect-DDGWU2xG.js";import"./VMenu-D1AAVsYt.js";import"./VCheckboxBtn-DNkfUJpf.js";import"./VSelectionControl-DqCfd3An.js";import"./filter-B81R-Kvh.js";/* empty css              *//* empty css                   */import"./VCounter-CfjE-LQa.js";const ca={__name:"dialogLoader",setup(g){const p=Ye();return(v,s)=>(_(),q(Se,{persistent:"",modelValue:$(p).loader,"onUpdate:modelValue":s[0]||(s[0]=y=>$(p).loader=y),width:"300"},{default:l(()=>[e(de,{color:"primary",width:"300"},{default:l(()=>[e(ee,{class:"pt-3 text-white"},{default:l(()=>[s[1]||(s[1]=D(" Cargando ")),e(Be,{indeterminate:"",class:"mt-4",color:"#fff"})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ma=()=>{const g=u([]),p=u(null),v=u([]),s=u([]),y=u([]),h=async()=>{try{const V=await ke("/get-config",{method:"GET"});g.value=V.tiendas,p.value=V.config.tienda_id}catch(V){console.error("Error obteniendo tiendas:",V)}},w=async(V,E)=>{try{const S=await ce(`/getdata/${V}/${E}`,{method:"GET"});v.value=S.empleados||[],y.value=S.clientes||[],await N()}catch(S){console.error("Error obteniendo empleados:",S)}},N=async()=>{try{const V=await ce("/getservicios",{method:"GET",params:{itemsPerPage:-1}});s.value=V.data||V||[]}catch(V){console.error("Error obteniendo servicios:",V),s.value=[]}};return{tienda:p,tiendas:g,empleados:v,servicios:s,clientes:y,getTiendas:h,getData:w,getServicios:N}},R=Xe({on(g,p){document.addEventListener(g,v=>p(v.detail))},emit(g,p){document.dispatchEvent(new CustomEvent(g,{detail:p}))},off(g,p){document.removeEventListener(g,p)}}),pa={class:"empleado-nombre"},fa=["onClick","data-dia","data-empleado","data-hora"],va=["onClick","onDragstart"],_a={style:{"text-transform":"capitalize"}},ga={__name:"EmpleadoComponent",props:{intervalos:Array,empleado:Object,citas:Array,horario:[Array,Object],dia_actual:String,interval_height:Number,fechas:Array,type:String,app_tienda_id:[String,Number]},setup(g){const p=g,v=u([]);var s=u({});const y=u({}),h=u({}),w=u({}),N=(n,d)=>{if(console.log("agregarHorarioPorEmpleado llamado con:",n,"fechas:",p.fechas),p.fechas&&p.fechas.length>0)return s.value={},S(p.fechas,d);n&&Array.isArray(n)&&n.length>0?S(n,d):(console.log("No hay horario para crear intervalos"),s.value={})},V=(n,d)=>{w.value=d},E=n=>{let d=n.target;for(;d.getAttribute("data-draggable")!="true";)d=d.parentElement;if(d.style.zIndex=-1,!w.value)return null;const b=document.elementFromPoint(n.clientX,n.clientY);if(!b)return null;const f=JSON.parse(JSON.stringify(w.value));f.fecha=b.getAttribute("data-dia"),f.hora=b.getAttribute("data-hora"),f.app_empleado_id=b.getAttribute("data-empleado"),f.start=`${f.fecha} ${f.hora}`,f.tipo="peluqueria",w.value=null,d.style.zIndex=100,R.emit("edit_cita",f)},S=(n,d)=>{if(!n||!Array.isArray(n)||n.length===0){console.log("No hay horarios para crear intervalos");return}console.log("Creando intervalos para:",n,"día:",d),n.forEach(b=>{const f=Y(`${d} ${b.entrada}`,"YYYY-MM-DD HH:mm"),B=Y(`${d} ${b.salida}`,"YYYY-MM-DD HH:mm").diff(f,"minutes");oa.range(B/30).forEach((z,Z)=>{const ae=f.clone().add(Z*30,"minutes").format("HH:mm"),G=`${p.empleado.nombre}_${d}_${ae}`;s.value[G]||(s.value[G]=[]),s.value[G].push(G)})}),console.log("Intervalos creados:",s.value)},a=n=>{const d=!!s.value[n];return!d&&p.horario&&Array.isArray(p.horario)&&p.horario.length>0&&console.log(`Intervalo no encontrado para ref: ${n}, intervalos disponibles:`,Object.keys(s.value)),d},H=(n=null)=>{if(n&&n.id)return R.emit("open_form",n);R.emit("open_form",{app_empleado_id:p.empleado.id,fecha:p.dia_actual,intervalo:n})},X=n=>{const d=`${n.start.substring(0,10)}_${n.start.substring(11)}`,b=`${p.empleado.nombre}_${d}`;return h.value[b]?{display:"block",top:`${h.value[b].offsetTop}px`,height:`${n.duracion/30*p.interval_height}px`,backgroundColor:n.color,position:"absolute",width:"auth"}:{display:"none"}};return L(w,n=>{},{deep:!0}),L(()=>p.citas,n=>{Ge(()=>{v.value=n})},{immediate:!0}),L(()=>p.horario,n=>{console.log("Horario recibido en EmpleadoComponent:",n,"para día:",p.dia_actual),n&&Array.isArray(n)&&n.length>0?N(n,p.dia_actual):s.value={}},{immediate:!0}),L(()=>p.dia_actual,n=>{p.horario&&N(p.horario,n)}),(n,d)=>(_(),U("div",null,[x("div",{class:he([[g.type=="week"?"week":"day",{"hide-column":!p.horario||!Array.isArray(p.horario)||p.horario.length===0}],"empleado-column"])},[x("div",pa,[e(Re,{color:g.empleado.color,to:{path:`/guardar-empleado-app?id=${g.empleado.id}`},small:"",class:"white--text"},{default:l(()=>[D(A(g.empleado.nombre)+" - "+A(g.empleado.id),1)]),_:1},8,["color","to"])]),(_(!0),U(P,null,re(g.intervalos,(b,f)=>(_(),U(P,{key:f},[p.horario&&Array.isArray(p.horario)&&p.horario.length>0&&a(`${g.empleado.nombre}_${g.dia_actual}_${b}`)?(_(),U("div",{key:0,onClick:C=>H(b),class:"empleado-row",style:Fe({height:g.interval_height+"px"}),ref_for:!0,ref:C=>{C&&(h.value[`${g.empleado.nombre}_${g.dia_actual}_${b}`]=C)},"data-dia":g.dia_actual,"data-empleado":g.empleado.id,"data-hora":b,onDragover:d[0]||(d[0]=$e(()=>{},["prevent"])),onDragenter:d[1]||(d[1]=$e(()=>{},["prevent"]))},A(b),45,fa)):(_(),U("div",{key:1,style:Fe({height:g.interval_height+"px"}),class:"empleado-row disabled-row"},A(b),5))],64))),128)),(_(!0),U(P,null,re(v.value,b=>(_(),U("div",{class:"cita-element",onClick:f=>H(b),ref_for:!0,ref:f=>y.value[`${g.empleado.nombre}_${g.dia_actual}`]=f,style:Fe([X(b)]),onDragstart:f=>V(f,b),onDragend:d[2]||(d[2]=f=>E(f)),"data-draggable":"true",draggable:"true"},[b.confirmada?j("",!0):(_(),q(Je,{key:0,small:""},{default:l(()=>d[3]||(d[3]=[D("ri-error-warning-fill")])),_:1})),x("i",_a,A(b.usuario)+" - "+A(b.telefono),1)],44,va))),256))],2)]))}},ba={class:"d-flex align-center"},ya={class:"text-center pb-6"},ha={class:"text-h4 mb-2"},Va={class:"text-body-1"},Da={__name:"CRUDSelect",props:{modelValue:{type:Number,required:!0,default:null},title:{type:String,required:!0},items:{type:Array,required:!0},itemTitle:{type:String,required:!0},itemValue:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String},rules:{type:Array},clearable:{type:Boolean,default:!1},density:{type:String}},emits:["update:modelValue","update:selectedItem","submit","delete"],setup(g,{emit:p}){const v=g,s=p,y=u(null),h=u({id:null,nombre:"",apellidos:"",telefono:"",email:"",observaciones:""}),w=u({}),N=u(!0),V=u(!1),E=u(!1),S=f=>{s("update:modelValue",f)},a=()=>{var f;(f=N.value)==null||f.validate().then(({valid:C})=>{C&&(console.log("selectedItem.value",h.value),s("update:selectedItem",h.value),s("submit",h.value),V.value=!1,Ge(()=>{var B,K;(B=N.value)==null||B.reset(),(K=N.value)==null||K.resetValidation()}))})},H=f=>{f!=null?h.value=f:(y.value=null,b()),s("update:selectedItem",h.value),V.value=!0},X=()=>{V.value=!1},n=f=>{f!=null&&(h.value=f),E.value=!0},d=()=>{s("delete",h.value.id),y.value=null,b(),E.value=!1},b=()=>{h.value={id:null,nombre:"",apellidos:"",telefono:"",email:"",observaciones:""}};return L(()=>{v.modelValue!=null&&(y.value=v.modelValue)}),L(y,f=>{f!=null&&(h.value=v.items.find(C=>C.id===f))}),(f,C)=>{const B=We,K=na;return _(),U(P,null,[x("div",ba,[e(Ce,{modelValue:$(y),"onUpdate:modelValue":[C[0]||(C[0]=z=>Ve(y)?y.value=z:null),S],density:g.density,items:v.items,"item-title":v.itemTitle,"item-value":v.itemValue,label:v.label,placeholder:v.placeholder,rules:v.rules,clearable:v.clearable},{item:l(({props:z,item:Z})=>[e(sa,Ze(ea(z)),{append:l(()=>[e(T,{icon:"ri-edit-box-line",variant:"text",size:"small",onClick:ae=>H(Z.raw)},null,8,["onClick"]),e(T,{icon:"ri-delete-bin-7-line",variant:"text",color:"error",size:"small",onClick:ae=>n(Z.raw)},null,8,["onClick"])]),default:l(()=>[e(ua,null,{default:l(()=>[D(A(Z.raw[z.itemTitle]),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","density","items","item-title","item-value","label","placeholder","rules","clearable"]),e(T,{icon:"ri-add-line",size:"small",class:"ml-2",onClick:C[1]||(C[1]=z=>H(null))})]),e(Se,{modelValue:$(V),"onUpdate:modelValue":C[3]||(C[3]=z=>Ve(V)?V.value=z:null),width:"500"},{default:l(()=>[e(de,null,{default:l(()=>[e(B,{variant:"text",size:"default",onClick:X}),e(De,null,{default:l(()=>[x("div",ya,[x("h4",ha,A($(y)==null?`Nuevo ${v.title}`:`Editar ${v.title}`),1),x("div",Va," Ingrese los datos del "+A(v.title),1)])]),_:1}),e(ee,null,{default:l(()=>[e(Ke,{ref_key:"refForm",ref:N,modelValue:$(w),"onUpdate:modelValue":C[2]||(C[2]=z=>Ve(w)?w.value=z:null),onSubmit:$e(a,["prevent"])},{default:l(()=>[e(oe,null,{default:l(()=>[aa(f.$slots,"form"),e(M,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(T,{type:"submit",color:"primary"},{default:l(()=>C[4]||(C[4]=[D(" Confirmar ")])),_:1}),e(T,{type:"button",color:"secondary",variant:"outlined",onClick:X},{default:l(()=>C[5]||(C[5]=[D(" Cancelar ")])),_:1})]),_:1})]),_:3})]),_:3},8,["modelValue"])]),_:3})]),_:3})]),_:3},8,["modelValue"]),e(K,{isDialogVisible:$(E),confirmationQuestion:`¿Estás seguro de eliminar ${v.title}?`,confirmTitle:`Eliminar ${v.title}`,onConfirm:d},null,8,["isDialogVisible","confirmationQuestion","confirmTitle"])],64)}}},$a={__name:"deleteEventDialog",setup(g){const p=Ye(),v=u(!1),s=[{id:1,label:"No asiste"},{id:2,label:"Cancela cliente"},{id:3,label:"Erronea"}],y=u(null),h=u(null),w=V=>{y.value=V};R.on("open_delete_dialog",V=>{v.value=!0,h.value=V});const N=async()=>{try{const V=await ce(`/eliminarcita/${h.value}/${y.value}`,{method:"GET"});p.success("Cita eliminada"),v.value=!1,R.emit("close_appoiment_dialog")}catch(V){console.log(V)}};return(V,E)=>(_(),q(Se,{modelValue:v.value,"onUpdate:modelValue":E[1]||(E[1]=S=>v.value=S),width:"500"},{default:l(()=>[e(de,null,{default:l(()=>[e(ee,{class:"pt-4"},{default:l(()=>[E[2]||(E[2]=x("h3",{class:"text-center"}," Para eliminar la cita debe indicar un motivo ",-1)),e(M,{"justify-center":"",cols:"12",class:"d-flex py-6 justify-center"},{default:l(()=>[(_(),U(P,null,re(s,S=>e(T,{onClick:a=>w(S.id),color:y.value==S.id?"success":"grey darken-2",class:"mx-2",small:""},{default:l(()=>[D(A(S.label),1)]),_:2},1032,["onClick","color"])),64))]),_:1})]),_:1}),e(ta,null,{default:l(()=>[e(oe,{align:"center",justify:"center"},{default:l(()=>[y.value?(_(),q(T,{key:0,onClick:N,small:"",md:"3",rounded:"",depressed:"",color:"danger",class:"white--text red mt-0 ml-4 mb-4"},{default:l(()=>E[3]||(E[3]=[D("Eliminar")])),_:1})):j("",!0),e(T,{onClick:E[0]||(E[0]=S=>v.value=!1),small:"",md:"3",rounded:"",depressed:"",color:"success",class:"white--text mt-0 mx-2 mb-4"},{default:l(()=>E[4]||(E[4]=[D("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ka={style:{"font-size":"12px !important","margin-top":"10px !important","margin-bottom":"10px !important"}},Ca={__name:"AppointmentDialog",props:{isDialogOpen:{type:Boolean,default:!1},app_tienda_id:{type:Number,default:null},item:{type:Object,default:()=>({})},empleados:{type:Array,default:()=>[]},servicios:{type:Array,default:()=>[]},clientes:{type:Array,default:()=>[]},user:{type:Object,default:()=>({id:null,nombre:"",apellidos:"",email:"",telefono:"",codigo:"",observaciones:"",avatar:null,password:null,direccion:[]})}},emits:["generar_factura","save","updatecitas","refresh","submit","update:isDialogOpen"],setup(g,{emit:p}){const v=Ye(),s=g,y=p,h=u(s.isDialogOpen),w=u(null),N=u(!1),V=u(!1),E=u("");u(!1);const S=u(!1),a=u({id:null,app_empleado_id:null,fecha:null,servicios:[],precio:0,duracion:0,start:null,end:null}),H=u({}),X=u({historial:[],usuario:{observaciones:""}}),n=u({id:null,nombre:"",apellidos:"",telefono:"",email:"",observaciones:""}),d=u([]),b=u([]),f=u([]);u("nuevo");const C=u(null),B=u(!1),K=t=>{if(!t)return!0;const o=Number(t);return!isNaN(o)&&isFinite(o)||"Debe ser un número válido"};te(()=>[]);const z=u(!1),Z=(t,o)=>{let F=[];return z.value==!0?t.forEach((O,ne,m)=>{let se=Y(`2021-03-26 ${O}`,"YYYY-MM-DD HH:mm"),J=[-60,-30,0,...Q._.range(o/30+2).map(me=>(me+1)*30)].map(me=>se.clone().add(me,"minutes").format("HH:mm")),i=m.includes(J[0])&&m.includes(J[1]),r=!m.includes(J[1]),c=m.includes(J[J.length-2])&&m.includes(J[J.length-3]),k=!m.includes(J[J.length-3]),I=Q._.drop(J,2),W=Q._.dropRight(I,3),le=Q._.difference(W,m).length===0;(i||r)&&(c||k)&&le&&F.push(O)}):t.forEach((O,ne,m)=>{let se=Y(`2021-03-26 ${O}`,"YYYY-MM-DD HH:mm"),J=[-60,-30,0,...Q._.range(o/30+2).map(k=>(k+1)*30)].map(k=>se.clone().add(k,"minutes").format("HH:mm")),i=Q._.drop(J,2),r=Q._.dropRight(i,3);Q._.difference(r,m).length===0&&F.push(O)}),F},ae=t=>{f.value=t.map(o=>({app_empleado_id:o.app_empleado_id,nombre_empleado:o.nombre_empleado,horario:Z(o.diferencia,a.value.duracion)}))},G=t=>(E.value=t,V.value=!0,null),ie=async()=>{if(a.value.servicios.length==0&&a.value.fecha==null&&a.value.app_empleado_id==null)return G("Asigne un empleado, dia y servicios para consultar las citas disponibles");if(a.value.servicios.length==0&&a.value.fecha==null)return G("Asigne un dia en el calendario y servicios para consultar las citas disponibles");if(a.value.servicios.length==0)return G("Asigne servicios para consultar las citas disponibles");if(a.value.app_empleado_id==null)return G("Asigne un empleado para consultar las citas disponibles");a.value.fecha==null&&(a.value.fecha=Y().format("YYYY-MM-DD"));let t={id:a.value.id,fecha:a.value.fecha,tienda_id:s.app_tienda_id,tipo:"peluqueria",empleado_id:a.value.app_empleado_id};a.value.precio=0,a.value.precio=a.value.servicios.reduce((F,O)=>F+O.precio,0),a.value.duracion=a.value.servicios.reduce((F,O)=>F+O.duracion,0);const o=await ke("/app/buscar-horario-disponible",{method:"POST",body:t});a.value.id||(a.value.start=a.value.fecha,a.value.end=null),C.value=ae(o)},Ee=(t,o)=>{let F="";return a.value.start!=null&&(F=a.value.start.substring(11,16)),t==F&&a.value.app_empleado_id==o?(B.value=!0,"success"):"secondary"},pe=t=>`${t.nombre} ${t.apellidos}`,Me=t=>{h.value=t,y("update:isDialogOpen",t)};te(()=>X.value.historial.length>0?X.value.historial.map(t=>t.servicio):null);const xe=()=>{h.value=!1,y("update:isDialogOpen",!1)},Ae=()=>{console.log("saveEvent")},we=(t,o)=>{B.value=!1,S.value=!0,a.value.tipo="peluqueria",a.value.start=`${a.value.fecha} ${t}`,a.value.end=Y(a.value.start).clone().add(a.value.duracion,"minutes").format("YYYY-MM-DD HH:mm")},Oe=()=>y("save",a.value),ge=()=>{f.value=[],a.value={id:null,app_empleado_id:null,app_usuario_id:null,app_tienda_id:null,app_mascota_id:null,tipo_id:1,color:null,start:null,end:null,duracion:null,servicios:[],fecha:null,observacionesMascota:"",observacionesUsuario:"",confirmada:1,recogida:0,direccion_recogida:null,direccion_entrega:null,pago:0,precio:0}},Te=t=>n.value=t,Ne=async t=>{try{const o=await ce("/saveusuario",{method:"POST",body:n.value});y("refresh",o.data),y("update:isDrawerOpen",!1)}catch(o){o.status==422&&(errors.value=o.response._data.errors)}},be=async t=>{var o,F;if(t)try{const O=await ke(`/proveedores/${t}`,{method:"DELETE"});proveedores.value=proveedores.value.filter(ne=>ne.id!==t),factura.value.proveedor_id=null,resetProveedorSelected(),snackbarColor.value="success",snackbarText.value=O.message,snackbar.value=!0}catch(O){console.error(O),snackbarColor.value="error",snackbarText.value=((F=(o=O.response)==null?void 0:o._data)==null?void 0:F.message)??"Error al eliminar el proveedor",snackbar.value=!0}},ye=t=>{a.value=JSON.parse(JSON.stringify(t)),a.value.fecha=t.start.substring(0,10),a.value.tipo="peluqueria",a.value.tienda_id=s.app_tienda_id},He=async()=>{try{const t=await ce(`/confirmar-cita/${a.value.id}`,{method:"GET"});t&&t.confirmada!==void 0?a.value.confirmada=t.confirmada?1:0:t&&t.data&&t.data.confirmada!==void 0&&(a.value.confirmada=t.data.confirmada?1:0),y("updatecitas"),v.success("Estado de la cita actualizado")}catch(t){console.error("Error confirmando cita:",t),v.error("Error al actualizar el estado de la cita")}},Ue=()=>R.emit("open_delete_dialog",a.value.id),Ie=()=>y("generar_factura",a.value.id);return R.on("close_appoiment_dialog",()=>{h.value=!1,ge(),y("updatecitas")}),R.on("close_form",()=>{ge(),h.value=!1}),R.on("open_form",async t=>{(!s.servicios||s.servicios.length===0)&&y("refresh"),t.id?(ye(t),ie()):(a.value.fecha=t.fecha,a.value.app_empleado_id=t.app_empleado_id,a.value.start=`${t.fecha} ${t.intervalo}`,a.value.servicios||(a.value.servicios=[])),h.value=!0}),L(()=>s.isDialogOpen,t=>{t!=null&&(h.value=t)}),L(()=>s.item,t=>{t!=null&&(a.value=JSON.parse(JSON.stringify(t)))},{deep:!0}),L(()=>s.user,t=>{t!=null&&(H.value=JSON.parse(JSON.stringify(t)))},{deep:!0}),L(()=>s.empleados,t=>{t!=null&&Array.isArray(t)&&(d.value=JSON.parse(JSON.stringify(t)),d.value.unshift({id:null,nombre:"Selecciona un empleado"}))},{deep:!0}),L(()=>s.servicios,t=>{t!=null&&Array.isArray(t)?b.value=JSON.parse(JSON.stringify(t)):b.value=[]},{deep:!0,immediate:!0}),L(()=>a.value.servicios,t=>{t.length>0&&(a.value.end=Y(a.value.start).clone().add(a.value.duracion,"minutes").format("YYYY-MM-DD HH:mm"))}),(t,o)=>{const F=We,O=Da,ne=ia;return _(),U(P,null,[e(Se,{modelValue:h.value,"onUpdate:modelValue":[o[13]||(o[13]=m=>h.value=m),Me],width:"900px",persistent:""},{default:l(()=>[e(de,null,{default:l(()=>[e(F,{variant:"text",size:"default",onClick:xe}),e(De,{class:"d-flex justify-center text-h4"},{default:l(()=>[D(A(a.value.id==null?"Agregar nueva":"Editar")+" cita ",1)]),_:1}),e(Ke,{ref_key:"formEvent",ref:w,modelValue:N.value,"onUpdate:modelValue":o[12]||(o[12]=m=>N.value=m),onSubmit:$e(Ae,["prevent"])},{default:l(()=>[e(ee,{class:"mt-3"},{default:l(()=>[e(de,null,{default:l(()=>[e(De,null,{default:l(()=>o[14]||(o[14]=[D("Datos del cliente")])),_:1}),e(ee,null,{default:l(()=>[e(oe,{dense:""},{default:l(()=>[e(M,{cols:"12",md:"4"},{default:l(()=>[e(Ce,{label:"Empleado",modelValue:a.value.app_empleado_id,"onUpdate:modelValue":[o[0]||(o[0]=m=>a.value.app_empleado_id=m),ie],items:d.value,"item-title":"nombre","item-value":"id"},null,8,["modelValue","items"])]),_:1}),e(M,null,{default:l(()=>[e(O,{title:"Cliente",modelValue:a.value.app_usuario_id,"onUpdate:modelValue":o[6]||(o[6]=m=>a.value.app_usuario_id=m),items:s.clientes,"item-title":pe,"item-value":"id",placeholder:"Selecciona un cliente",clearable:"","onUpdate:selectedItem":Te,onSubmit:Ne,onDelete:be},{form:l(()=>[e(M,{cols:"12",md:"6"},{default:l(()=>[e(_e,{modelValue:n.value.nombre,"onUpdate:modelValue":o[1]||(o[1]=m=>n.value.nombre=m),label:"Nombre",placeholder:"John",rules:["requiredValidator"in t?t.requiredValidator:$(qe)]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12",md:"6"},{default:l(()=>[e(_e,{modelValue:n.value.apellidos,"onUpdate:modelValue":o[2]||(o[2]=m=>n.value.apellidos=m),label:"Apellidos",placeholder:"Doe",rules:["requiredValidator"in t?t.requiredValidator:$(qe)]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12"},{default:l(()=>[e(_e,{modelValue:n.value.telefono,"onUpdate:modelValue":o[3]||(o[3]=m=>n.value.telefono=m),label:"Teléfono",placeholder:"+1 9876543210",rules:[t.phoneValidator]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12"},{default:l(()=>[e(_e,{modelValue:n.value.email,"onUpdate:modelValue":o[4]||(o[4]=m=>n.value.email=m),label:"Email",placeholder:"johndoe@email.com",rules:["requiredValidator"in t?t.requiredValidator:$(qe),"emailValidator"in t?t.emailValidator:$(ra)]},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12"},{default:l(()=>[e(Pe,{modelValue:n.value.observaciones,"onUpdate:modelValue":o[5]||(o[5]=m=>n.value.observaciones=m),label:"Observaciones",placeholder:"Observaciones"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","items"])]),_:1}),e(M,{cols:"12"},{default:l(()=>[e(Pe,{outlined:"",height:"50px",modelValue:H.value.observaciones,"onUpdate:modelValue":o[7]||(o[7]=m=>H.value.observaciones=m),label:"Observaciones del cliente"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,null,{default:l(()=>[e(de,null,{default:l(()=>[e(De,null,{default:l(()=>o[15]||(o[15]=[D("Datos del Servicios")])),_:1}),e(ee,null,{default:l(()=>[e(oe,null,{default:l(()=>[e(M,{cols:"12",md:"10"},{default:l(()=>[e(Ce,{label:"Servicios",modelValue:a.value.servicios,"onUpdate:modelValue":[o[8]||(o[8]=m=>a.value.servicios=m),ie],items:b.value,"item-title":"nombre","return-object":"",multiple:"",chips:""},null,8,["modelValue","items"])]),_:1}),e(M,{cols:"12",md:"2"},{default:l(()=>[e(_e,{modelValue:a.value.precio,"onUpdate:modelValue":o[9]||(o[9]=m=>a.value.precio=m),label:"Precio",rules:[K]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,null,{default:l(()=>[e(oe,null,{default:l(()=>[e(M,{cols:"12",md:"5",class:"d-flex",style:{"margin-top":"10px"}},{default:l(()=>[a.value.id?(_(),q(T,{key:0,rounded:"",depressed:"",onClick:Ue,class:"mr-2"},{default:l(()=>o[16]||(o[16]=[D("eliminar")])),_:1})):j("",!0),a.value.id?(_(),q(T,{key:1,rounded:"",onClick:He,outlined:"",color:a.value.confirmada==1||a.value.confirmada===!0?"grey":"success",class:"mr-2"},{default:l(()=>[D(A(a.value.confirmada==1||a.value.confirmada===!0?"Desconfirmar":"Confirmar"),1)]),_:1},8,["color"])):j("",!0),a.value.id?(_(),q(T,{key:2,class:"white--text mr-2",rounded:"",onClick:Ie,outlined:"",color:"green"},{default:l(()=>o[17]||(o[17]=[D("Generar Factura")])),_:1})):j("",!0)]),_:1})]),_:1}),e(oe,null,{default:l(()=>[e(M,{cols:"12",md:"6",class:"my-1 py-1"},{default:l(()=>[e(ne,{modelValue:a.value.fecha,"onUpdate:modelValue":[o[10]||(o[10]=m=>a.value.fecha=m),ie],label:"Fecha",placeholder:"Selecciona una fecha",config:{inline:!0,locale:$(da.Spanish),firstDayOfWeek:1,dateFormat:"Y-m-d",altFormat:"d-m-Y",altInput:!0}},null,8,["modelValue","config"])]),_:1}),e(M,{cols:"12",md:"5",class:"pt-0"},{default:l(()=>[x("div",ka,[o[18]||(o[18]=x("strong",null,"INICIO: ",-1)),S.value||a.value.id?(_(),U(P,{key:0},[D(A(a.value.start),1)],64)):j("",!0),o[19]||(o[19]=x("br",null,null,-1)),o[20]||(o[20]=x("strong",null,"FIN: ",-1)),S.value||a.value.id?(_(),U(P,{key:1},[D(A(a.value.end),1)],64)):j("",!0),o[21]||(o[21]=x("br",null,null,-1)),o[22]||(o[22]=x("strong",null,"DURACIÓN: ",-1)),D(A(a.value.duracion),1)]),(_(!0),U(P,null,re(f.value,(m,se)=>(_(),q(oe,{dense:"",key:m.app_empleado_id},{default:l(()=>[e(M,{cols:"12"},{default:l(()=>[m.horario.length>0?(_(),q(Re,{key:0,"prepend-icon":"ri-account-circle-line",color:"success",variant:"outlined"},{default:l(()=>[D(A(m.nombre_empleado),1)]),_:2},1024)):j("",!0)]),_:2},1024),(_(!0),U(P,null,re(m.horario,(ue,fe)=>(_(),q(M,{key:fe,cols:"12",md:"3"},{default:l(()=>[e(T,{elevation:"2",onClick:J=>we(ue,m.app_empleado_id),rounded:"",small:"",block:"",color:Ee(ue,m.app_empleado_id)},{default:l(()=>[D(A(ue),1)]),_:2},1032,["onClick","color"])]),_:2},1024))),128))]),_:2},1024))),128)),e(T,{disabled:$(v).loader,class:"mt-3",onClick:o[11]||(o[11]=m=>Oe()),block:"",rounded:""},{default:l(()=>[D(A(a.value.id==null?"Guardar":"Editar")+" cita ",1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e($a)],64)}}},Ya={class:"dia-header"},Sa={class:"cita-container mt-2"},ml={__name:"index",emits:["open_dialog","abrirbusqueda"],setup(g,{emit:p}){const v=Ye(),{tienda:s,tiendas:y,empleados:h,clientes:w,servicios:N,getTiendas:V,getData:E,getServicios:S}=ma(),a=u(null),H=u("week"),X=["week","day"];u(0);const n=u(26),d=u(Y().format("YYYY-MM-DD").substring(0,10)),b=Y().format("YYYY-MM-DD").substring(0,10),f=u("08:00"),C=u("21:30"),B=u([]),K=u([]);u("");const z=u(!1),Z=u(!1),ae=u(!1);u(null),te(()=>Y(d).format("MMMM"));const G=u({id:null,app_empleado_id:null,app_usuario_id:null,app_tienda_id:s.value,app_mascota_id:null,tipo_id:1,color:null,start:null,end:null,duracion:null,servicios:[],fecha:null,observacionesMascota:"",observacionesUsuario:"",confirmada:1,recogida:0,direccion_recogida:null,direccion_entrega:null,pago:0,precio:""}),ie=te(()=>{let i=h.value.flatMap(c=>(c.horario||[]).map(k=>({...k,app_empleado_id:k.app_empleado_id||c.id})));const r={};return i.forEach(c=>{let k=`${c.app_empleado_id}_${c.dia}`;(r[k]=r[k]||[]).push(c)}),r}),Ee=te(()=>{let i=h.value.flatMap(c=>c.fecha);const r={};return i.forEach(c=>{let k=`${c.app_empleado_id}_${c.fecha}`;(r[k]=r[k]||[]).push(c)}),r}),pe=te(()=>{var r=Y(d.value).clone().startOf("isoweek");return Q._.range(7).map(k=>{let I=Y(r).add(k,"days");return{numero_dia:I.format("DD"),nombre_dia:I.format("dddd"),full_date:I.format("YYYY-MM-DD")}})}),Me=te(()=>{if(H.value=="day"){let i=pe.value.findIndex(r=>r.full_date==d.value);return[pe.value[i]]}else return pe.value}),xe=()=>d.value=Y().format("YYYY-MM-DD").substring(0,10),Ae=i=>({Monday:"Lunes",Tuesday:"Martes",Wednesday:"Miercoles",Thursday:"Jueves",Friday:"Viernes",Saturday:"Sabado",Sunday:"Domingo"})[i],we=()=>{let i=Y(d.value).weekday()==1?2:1,r=H.value=="week"?7:i;d.value=Y(d.value).subtract(r,"days").format("YYYY-MM-DD")},Oe=()=>{let i=Y(d.value).weekday()==6?2:1,r=H.value=="week"?7:i;d.value=Y(d.value).add(r,"days").format("YYYY-MM-DD")};la(async()=>{z.value=!1,m(),await V(),a.value="peluqueria",await S()});const ge=()=>O(d.value),Te=i=>{let r=w.value.findIndex(c=>c.id==i.id);r>-1?w.value[r]=i:w.value.unshift(i)},Ne=i=>H.value=i,be=u(null),ye=u(null),He=i=>{be.value.scrollLeft=i.target.scrollLeft},Ue=i=>{ye.value.scrollLeft=i.target.scrollLeft},Ie=(i,r)=>ne.value[`${i.nombre}_${r}`],t=(i,r)=>{let c,k=Y(`${r}`,"YYYY-MM-DD");if(Y("2021-11-15","YYYY-MM-DD"),!i.fecha||i.fecha.length==0){const I=Y(r).day(),W=`${i.id}_${I}`,le=ie.value[W];le&&le.length>0?c=le:c=void 0}else{let I=[],W=[],le=[],me=!1,ze=!1,Le=!1;c=void 0,i.fecha.forEach(ve=>{let je=Y(`${ve.fecha}`,"YYYY-MM-DD");if(s==ve.app_tienda_id)if(JSON.stringify(je)==JSON.stringify(k))W==null&&(W=[]),W.push({app_empleado_id:i.id,app_tienda_id:ve.app_tienda_id,dia:Y(r).day(),entrada:ve.entrada,salida:ve.salida}),me=!0;else{ze=!0;const Qe=Y(r).day();I=ie.value[`${i.id}_${Qe}`]}else JSON.stringify(je)==JSON.stringify(k)&&(le=void 0,Le=!0)}),me?c=W:Le?c=le:ze&&(c=I)}return c},o=(i,r)=>Ee.value[`${i.id}_${r}`],F=i=>{i.value=i,d.value=i.full_date,H.value="day"},O=async i=>{try{const r=await ce(`/geteventsbymonth/${i}`,{method:"GET"});K.value=r}catch{}},ne=te(()=>{const i={};return K.value.forEach(r=>{let c=r.start.substring(0,10),k=`${r.empleado}_${c}`;(i[k]=i[k]||[]).push(r)}),i}),m=()=>{let i=Y(`2021-03-26 ${f.value}`,"YYYY-MM-DD HH:mm"),c=Y(`2021-03-26 ${C.value}`,"YYYY-MM-DD HH:mm").diff(i,"minutes"),k=Q._.range(c/30);B.value=k.map((I,W)=>i.clone().add(W*30,"minutes").format("HH:mm"))};R.on("edit_cita",i=>{se(i)});const se=async i=>{try{const r=await ce("/savecita",{method:"POST",body:i});R.emit("close_form"),v.success("Cita actualizada con exito"),O(d.value)}catch(r){console.log(r)}},ue=()=>Z.value=!0,fe=async()=>{(!N.value||N.value.length===0)&&await S(),R.emit("open_form",{fecha:d.value})},J=async i=>{try{const r=await ke(`generate-factura/${i}`);v.success("Factura generada con exito")}catch{v.error("Error generando factura")}};return L(d,(i,r)=>{O(i)},{immediate:!0}),L(s,async(i,r)=>{s.value=parseInt(s.value),G.value.app_tienda_id=s.value,i&&await E(a.value,i)},{immediate:!0}),(i,r)=>(_(),U("section",null,[e(de,null,{default:l(()=>[e(ee,null,{default:l(()=>[$(v).loader?(_(),q(Be,{key:0,class:"mb-4",indeterminate:"",color:"primary"})):j("",!0),e(oe,null,{default:l(()=>[e(M,{cols:"12",md:"3"},{default:l(()=>[e(Ce,{items:$(y),modelValue:$(s),"onUpdate:modelValue":r[0]||(r[0]=c=>Ve(s)?s.value=c:null),"item-title":"nombre","item-value":"id",variant:"outlined","hide-details":"",label:"Tienda"},null,8,["items","modelValue"]),r[4]||(r[4]=x("br",null,null,-1)),e(T,{onClick:fe},{default:l(()=>r[2]||(r[2]=[D("Nuevo")])),_:1}),$(s)?(_(),q(T,{key:0,onClick:ue,variant:"outlined",class:"ml-2"},{default:l(()=>r[3]||(r[3]=[D("Buscar cita")])),_:1})):j("",!0)]),_:1}),$(s)?(_(),q(M,{key:0,cols:"12",md:"8"},{default:l(()=>[(_(),U(P,null,re(X,c=>e(T,{rounded:"",depressed:"",class:"mr-2",color:c==H.value?"success":"",key:c,onClick:k=>Ne(c)},{default:l(()=>[D(A(c),1)]),_:2},1032,["color","onClick"])),64)),e(T,{outlined:"",class:"ml-4",color:"grey darken-2",onClick:xe},{default:l(()=>r[5]||(r[5]=[D(" Hoy ")])),_:1}),e(T,{fab:"",text:"",class:"ml-2",small:"",color:"grey darken-2",onClick:we},{default:l(()=>[e(Je,{small:""},{default:l(()=>r[6]||(r[6]=[D("ri-arrow-left-s-line")])),_:1})]),_:1}),e(T,{fab:"",text:"",class:"ml-2",small:"",color:"grey darken-2",onClick:Oe},{default:l(()=>[e(Je,{small:""},{default:l(()=>r[7]||(r[7]=[D("ri-arrow-drop-right-line")])),_:1})]),_:1})]),_:1})):j("",!0),$(s)?(_(),q(M,{key:1,cols:"12"},{default:l(()=>[x("div",{ref_key:"false_scroll",ref:be,class:"false_scroll",onScroll:Ue},r[8]||(r[8]=[x("div",{class:"false_scroll_container"},null,-1)]),544)]),_:1})):j("",!0),$(s)?(_(),q(M,{key:2,cols:"12"},{default:l(()=>[x("div",{ref_key:"calendar_wrap",ref:ye,onScroll:He,class:"calendar-wrapper"},[x("div",{class:he(["dia-container",{"full-width":H.value=="day"}])},[(_(!0),U(P,null,re(Me.value,(c,k)=>(_(),U("div",{class:he(["dia-component",{"full-width":H.value=="day"}])},[x("div",Ya,[x("span",null,A(Ae(c.nombre_dia)),1),e(T,{id:"diabtn",onClick:I=>F(c),class:he({"green white--text":c.full_date==$(b)})},{default:l(()=>[D(A(c.numero_dia),1)]),_:2},1032,["onClick","class"])]),x("div",Sa,[(_(!0),U(P,null,re($(h),(I,W)=>(_(),q(ga,{intervalos:B.value,key:I.id,app_tienda_id:$(s),empleado:I,citas:Ie(I,c.full_date),horario:t(I,c.full_date),fechas:o(I,c.full_date),dia_actual:c.full_date,interval_height:n.value,type:H.value},null,8,["intervalos","app_tienda_id","empleado","citas","horario","fechas","dia_actual","interval_height","type"]))),128))])],2))),256))],2)],544)]),_:1})):j("",!0),e(M,{cols:"12",md:"3"})]),_:1})]),_:1})]),_:1}),e(Ca,{isDialogOpen:ae.value,"onUpdate:isDialogOpen":r[1]||(r[1]=c=>ae.value=c),item:G.value,app_tienda_id:$(s),empleados:$(h),servicios:$(N)||[],clientes:$(w),user:i.usuario,onSave:se,onUpdatecitas:ge,onGenerar_factura:J,onRefresh:Te},null,8,["isDialogOpen","item","app_tienda_id","empleados","servicios","clientes","user"]),e(ca)]))}};export{ml as default};
