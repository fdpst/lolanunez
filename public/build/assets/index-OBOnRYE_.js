import{f as q}from"./formatters-zPA0pF4b.js";import{p as G}from"./paginationMeta-BbY5dJ0C.js";import{r as n,I as L,w as F,c as Q,b as t,e as i,n as a,ag as V,o as H,af as v,v as d,x as w,d as u,a0 as C,am as J,a as K}from"./main-C1cSucNj.js";import{_ as W}from"./DialogCloseBtn-d-aRwzHc.js";import{_ as X}from"./ConfirmDialog-BYCpVhgT.js";import{_ as Y}from"./FilterComponent-CEFcBL5a.js";import{$ as _}from"./api-DGW-Fn2Q.js";import{V as P}from"./VCard-DoJ7OvEk.js";import{V as Z}from"./VDialog-CiCxrpWH.js";import{V as $}from"./VCardText-iOQ31nyo.js";import{V as ee}from"./VSpacer-D5JLVMw2.js";import{V as E}from"./VDivider-BS9Tllbl.js";import{V as te}from"./VDataTableServer-Cu7-cFAP.js";import{V as ae}from"./VSelect-C8_y3N-_.js";import{V as le}from"./VForm-Dy7iSAGS.js";import{V as oe,a as M}from"./VRow-DdYzItfl.js";import"./helpers-DK5QwNv0.js";import"./AppDateTimePicker-CfAoPA-s.js";import"./VField-BymScPN-.js";import"./form-BJwA8ai1.js";import"./VInput-wvAgDqIB.js";import"./VTextField-BDUmA4Cs.js";/* empty css                   */import"./VCounter-tCKPKrdk.js";import"./VImg-D1aAeOw8.js";import"./VList-CJtIzW8v.js";import"./ssrBoot-DfsiD9ny.js";import"./VAvatar-BpNw3P6_.js";import"./VAutocomplete-AOfJDvsu.js";import"./filter-DDqFtplM.js";import"./VMenu-D5ZOve3c.js";import"./dialog-transition-apDHIwZf.js";import"./VCheckboxBtn-DqgUuTHD.js";import"./VSelectionControl-CM7Gd7lS.js";import"./VChip-Js2ye3Ji.js";import"./index-D-qiIO6U.js";import"./index-9rIf2CJL.js";/* empty css              */import"./VDataTable-r1BGz7ia.js";import"./VPagination-CdWCEz8X.js";import"./VTable-D9T-4tY3.js";const ie=["href"],se={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},re={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},ne={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},me={class:"d-flex gap-x-2 align-center me-2"},Ze={__name:"index",setup(pe){const r=n(10),s=n(1),x=n(),y=n(),k=n([]),c=n(0),m=n({search:"",cliente:{value:null},fecha:{start:"",end:""}}),U=[{title:"Fecha de creación",type:"date",active:!0,model:"fecha"}],g=n(!1),b=n(!1),D=n(null),S=n(0),f=n([]),T=[{title:"Fecha",key:"fecha"},{title:"Cliente",key:"cliente.nombre"},{title:"Total",key:"total"},{title:"PDF",key:"url"},{title:"Acciones",key:"actions",sortable:!1}],h=async()=>{try{const l=await _("/get-facturas",{method:"GET",params:{search:m.value.search,fecha_inicio:m.value.fecha.start,fecha_fin:m.value.fecha.end,itemsPerPage:r.value,page:s.value,sortBy:x.value,orderBy:y.value}});k.value=l.data,c.value=l.total,S.value=l.importe}catch(l){console.error(l)}},A=async()=>{f.value[0]=!0,await _("/delete-factura",{method:"POST",body:D.value}),f.value[0]=!1,g.value=!1,h()},I=async()=>{try{f.value[1]=!0;const l=await _("/exportar-facturas",{method:"GET",params:{search:m.value.search,fecha_inicio:m.value.fecha.start,fecha_fin:m.value.fecha.end,id_cliente:m.value.cliente.value,itemsPerPage:r.value,page:s.value,sortBy:x.value,orderBy:y.value}}),e=window.URL.createObjectURL(new Blob([l])),p=document.createElement("a");p.href=e,p.setAttribute("download","facturas.xlsx"),document.body.appendChild(p),p.click(),f.value[1]=!1}catch(l){console.log(l)}},z=l=>{var e,p;s.value=l.page,x.value=(e=l.sortBy[0])==null?void 0:e.key,y.value=(p=l.sortBy[0])==null?void 0:p.order},R=l=>{m.value=l},j=l=>{g.value=!0,D.value=l};return L(h),F([r,x,y,s],()=>{h()}),F(m,(l,e)=>{h()},{deep:!0}),(l,e)=>{const p=Y,B=K("IconBtn"),N=X,O=W;return H(),Q("section",null,[t(P,{title:"Filtrar",class:"mb-6"},{default:i(()=>[t($,{class:"d-flex flex-wrap gap-4"},{default:i(()=>[t(v,{to:{name:"apps-bills-add"}},{default:i(()=>e[9]||(e[9]=[d(" Crear nueva factura ")])),_:1}),t(v,{variant:"outlined","prepend-icon":"ri-upload-2-line",loading:a(f)[1],onClick:I},{default:i(()=>e[10]||(e[10]=[d(" Exportar ")])),_:1},8,["loading"]),t(ee),t(p,{value:a(m),headers:U,onInput:R},null,8,["value"])]),_:1}),t(E),t(te,{"items-per-page":a(r),"onUpdate:itemsPerPage":e[3]||(e[3]=o=>V(r)?r.value=o:null),page:a(s),"onUpdate:page":e[4]||(e[4]=o=>V(s)?s.value=o:null),items:a(k),"item-value":"id","items-length":a(c),headers:T,class:"text-no-wrap rounded-0","onUpdate:options":z},{"item.fecha":i(({item:o})=>[d(w(("formatDate"in l?l.formatDate:a(q))(o.fecha)),1)]),"item.total":i(({item:o})=>[d(w(parseFloat(o.total).toFixed(2))+"€ ",1)]),"item.url":i(({item:o})=>[u("a",{href:o.url,target:"_blank",style:{cursor:"pointer"}},[t(C,{icon:"ri-file-pdf-2-line"})],8,ie)]),"item.actions":i(({item:o})=>[t(B,{size:"small",onClick:ue=>j(o)},{default:i(()=>[t(C,{icon:"ri-delete-bin-7-line",title:"Eliminar"})]),_:2},1032,["onClick"]),t(B,{size:"small",to:{name:"apps-bills-view-id",params:{id:o.id}}},{default:i(()=>[t(C,{icon:"ri-edit-box-line",title:"Editar"})]),_:2},1032,["to"])]),bottom:i(()=>[t(E),u("div",se,[u("div",re,[e[11]||(e[11]=d(" Filas por página: ")),t(ae,{modelValue:a(r),"onUpdate:modelValue":e[0]||(e[0]=o=>V(r)?r.value=o:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),u("p",ne,w(("paginationMeta"in l?l.paginationMeta:a(G))({page:a(s),itemsPerPage:a(r)},a(c))),1),u("div",me,[t(v,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:a(s)<=1,onClick:e[1]||(e[1]=o=>a(s)<=1?s.value=1:s.value--)},null,8,["disabled"]),t(v,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:a(s)>=Math.ceil(a(c)/a(r)),onClick:e[2]||(e[2]=o=>a(s)>=Math.ceil(a(c)/a(r))?s.value=Math.ceil(a(c)/a(r)):s.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(N,{isDialogVisible:a(g),"onUpdate:isDialogVisible":e[5]||(e[5]=o=>V(g)?g.value=o:null),confirmationQuestion:"¿Está seguro que desea eliminar la factura seleccionada?",onConfirm:A},null,8,["isDialogVisible"]),t(Z,{modelValue:a(b),"onUpdate:modelValue":e[8]||(e[8]=o=>V(b)?b.value=o:null),width:"500"},{default:i(()=>[t(P,{class:"pa-sm-9 pa-3"},{default:i(()=>[t(O,{variant:"text",size:"default",onClick:e[6]||(e[6]=o=>b.value=!1)}),t($,{class:"pt-5"},{default:i(()=>[e[15]||(e[15]=u("div",{class:"text-center pb-6"},[u("h4",{class:"text-h4 mb-2"}," Confirmación de cambio de año fiscal ")],-1)),t(le,{onSubmit:J(l.cambiarAnioModal,["prevent"])},{default:i(()=>[t(oe,null,{default:i(()=>[t(M,{cols:"12"},{default:i(()=>e[12]||(e[12]=[u("div",{class:"text-center",style:{"font-size":"18px"}}," ¿Estás seguro que deseas cambiar el año fiscal? ",-1)])),_:1}),t(M,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:i(()=>[t(v,{type:"submit",loading:a(f)[2]},{default:i(()=>e[13]||(e[13]=[d(" Aceptar ")])),_:1},8,["loading"]),t(v,{color:"secondary",variant:"outlined",onClick:e[7]||(e[7]=o=>b.value=!1)},{default:i(()=>e[14]||(e[14]=[d(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Ze as default};
